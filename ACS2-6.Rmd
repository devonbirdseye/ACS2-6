---
title: "ACS2/6"
author: "Devon Birdseye"
date: "10/3/2019"
output: github_document
---

# Analysis of ACS2/6 mutant proteomics & comparison to BxM hybrid
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
set.seed(586)
```
## libraries
```{r libraries, include=FALSE}
library(biomaRt)
library(reshape2)
library(scales)
library(tidyverse)
library(AnnotationFilter)
library(ggplot2)
library(topGO)
library(latexpdf)
require(reutils)
require(readr)
require(XML)
library(scales)
library(DESeq2)
library(pathview)
library(gage)
library(gageData)
library(KEGGREST)
library(dplyr)
library(tidyr)
library(gridExtra)
library(factoextra)
library(EnvStats)
```
## Data import and prep
```{r Read in data, eval=FALSE, echo=FALSE}
df <- read.csv("CSVs/B73-Mo17-BM-ACS26 TMT10 100319.csv", stringsAsFactors = F)
PrevSL <- read.csv("CSVs/Seedling Leaf TMT10 030419.csv", stringsAsFactors = F)
PrevSL_trim <- PrevSL[,c(16,17,2:10)]
colnames(PrevSL_trim) <- c("GI", "Protein", "b731", "b732", "b733", "mo171", "mo172", "mo173", "bm1", "bm2", "bm3")
```

```{r BiomartRefSeqPepFun FUN, eval=FALSE, echo=FALSE}
# Function to download sequence info from Biomart using Refseq protein vector input (biomaRt package)
host="plants.ensembl.org"
mysets<-listDatasets(useMart("plants_mart", host = host))
myusemart <- useDataset("zmays_eg_gene", mart = useMart("plants_mart", host = host))

BiomartRefSeqPepFun <- function(GeneVector){
  biomart <-  getBM(attributes=c("maizegdb", "refseq_peptide"), filters = ("refseq_peptide"), values = list(GeneVector), mart = myusemart)
  biomartNoMissingMaizeGDB <- biomart[!(biomart$maizegdb==""),]
biomartNoMissingMaizeGDB
}
```

```{r Create vector of RefSeq Peptide IDs, eval=FALSE, echo=FALSE}
#remove "decoy hits"
df_NoDecoys <- df[-grep("decoy",df$Protein),]
#substring to just accession
RefSeqPepV <- substr(df_NoDecoys$Protein, start = 5, stop = 18)
#Remove any letters
RefSeqPepV2 <- gsub("- [A-z]", "", RefSeqPepV)
#Make accession vector a new column on df_NoDecoys
df_NoDecoys$RefSeqPep <- RefSeqPepV2
```

```{r Convert accessions via biomart, eval=FALSE, echo=FALSE}
#Run Biomart pull function
AccConv <- BiomartRefSeqPepFun(df_NoDecoys$RefSeqPep)

#restructure result so that multiple maizegdb accessions get their own column, and each row is a unique RefSeqPep
AccConv <- AccConv %>%
  group_by(refseq_peptide) %>%
  mutate(maizegdbID = paste0('maizegdb.bm.', row_number())) %>%
  spread(maizegdbID, maizegdb)
#re-order rows
AccConv <- AccConv[,c(1,2,8:15,3:7)]

#Check stats for biomart accession conversion
print(paste0("Input NCBI proteins = ",length(RefSeqPepV)))
print(paste0("NCBI proteins with corresponding maizegdb IDs in Biomart = ",length(unique(AccConv$refseq_peptide))))
```

```{r Merge bm accessions back to df, eval=FALSE, echo=FALSE}
df_NoDecoys_Biomart <- merge.data.frame(df_NoDecoys, AccConv, by.x = "RefSeqPep", by.y = "refseq_peptide", all=T)
```

```{r Create GI vector, eval=FALSE, echo=FALSE}
###Use the epost/efetch functions written by Laura to pull maizegdb accessions from xml as well
options(stringsAsFactors = FALSE)

require(reutils)
require(readr)
require(XML)

#get GI accessions
giAccessions<-PrevSL_trim$GI
#remove gi accessions with alphas AKA nonconvertible
giAccessions<-giAccessions[-grep(giAccessions, pattern = "[a-zA-Z]")]
#trim to remove last two empty lines
giAccessions <- giAccessions[1:9196]
```

```{r epost, efetch, eval=FALSE, echo=FALSE}
#if re-running this, delete old copy of efetch.txt from file first
#first, convert GI to UID
#because more than 500, need to use epost first
p <- epost(giAccessions, db = "protein")
#efetch genpept file format for each UID, save to text file (requirement for epost>500)
efetch(p, db="protein",retmode = "text", rettype="gp", outfile = "efetch.txt")
```

```{r UID vec, eval=FALSE, echo=FALSE}
##Pause a couple seconds while the efetch.txt file synchs to cloud, then continue:

#read in UID text
UIDVec<-read.delim(file="efetch.txt", header = FALSE)
#convert to vector
UIDVec<-UIDVec[,1]
#get gene IDs from full flat file
UIDVec2<-UIDVec[grep(UIDVec, pattern="GeneID")]
#gsub out "GeneID:" to get accession number
UIDVec2<-gsub(UIDVec2, pattern=".*:", replacement = "")
#check that there is a UID for each GI
length(UIDVec2)==length(giAccessions)
```

```{r UID to Zm, eval=FALSE, echo=FALSE}
#since >500, need to use epost
#loop across total number of batches of 500
#post to epost, fetch each XML, create conversion table
#get number of batches
batches<-seq(1:ceiling(length(UIDVec2)/200))
batchEnd<-0
#create empty df
NCBIConvert<-NULL
#loop across batches
for(i in 1:length(batches)){
  batchStart<-batchEnd+1
  if(i<length(batches)){batchEnd<-batchEnd+200}else(batchEnd<-length(UIDVec2))
  print(batchEnd)
  f<-epost(UIDVec2[batchStart:batchEnd], db="gene")
  allXML2<-content(efetch(f, db="gene", retmode="xml"), as="xml")
  #pull out gene reference locus tag, if exists, if not, return "NA"
  dbxrefs1<-as.list(xpathApply(allXML2,"//Gene-ref", function(x) {
             if("Gene-ref_locus-tag" %in% names(x)){xmlValue(x[["Gene-ref_locus-tag"]])}
             else {NA}
              }))
  #gsub out "ZEAMMB73_"
  dbxrefs1<-gsub(dbxrefs1, pattern = "ZEAMMB73_", replacement = "")
  #turn into character vector
  dbxrefs1<-unlist(dbxrefs1)

    
  #now get UIDs back (to check for length of XML)
  dbxrefs2<-as.list(xpathApply(allXML2,"//Entrezgene_track-info/Gene-track",function(x) {
             if("Gene-track_geneid" %in% names(x)){xmlValue(x[["Gene-track_geneid"]])}
             else {NA}
              }))
  #turn into character vector
  dbxrefs2<-unlist(dbxrefs2)
  
  #check that original gi length == number of XML entries efetched
  200==length(dbxrefs2)
  #check that number of Zm accessions matches number of gi accessions
  200==length(dbxrefs1)

  #put together
  tmp<-cbind(giAccessions[batchStart:batchEnd], dbxrefs2, dbxrefs1)
  NCBIConvert<-rbind(NCBIConvert, tmp)
}
#rename columns
colnames(NCBIConvert)<-c("GI", "UID", "maizegdb.epost")

NCBIConvert2 <- as.data.frame(NCBIConvert)

#remove missing maizegdbid columns
NCBIConvert2 <- NCBIConvert2[!(NCBIConvert2$maizegdb.epost=="NA"),]
#Print stats
print(paste0("Input numeric GIs with a corresponding numeric UID = ",length((NCBIConvert2$GI))))
print(paste0("Unique MaizeGDB IDs returned = ",length(unique(NCBIConvert2$maizegdb.epost))))
```

```{r Merge Acc Conversion back with Data, eval=FALSE, echo=FALSE}
df_NoDecoys_Biomart_epost <- merge.data.frame(df_NoDecoys_Biomart, NCBIConvert2, by.x = "Accession", by.y = "GI", all=T)

##make new column for complete V4 accessions
#choose the epost ID if available
df_NoDecoys_Biomart_epost$V4 <- df_NoDecoys_Biomart_epost$maizegdb.epost
#if no epost ID, choose the 1st biomart ID
df_NoDecoys_Biomart_epost$V4[is.na(df_NoDecoys_Biomart_epost$V4)]<- df_NoDecoys_Biomart_epost$maizegdb.bm.1[is.na(df_NoDecoys_Biomart_epost$V4)]
#if no epost or biomart ID, choose the GI
df_NoDecoys_Biomart_epost$V4[is.na(df_NoDecoys_Biomart_epost$V4)]<- df_NoDecoys_Biomart_epost$Accession[is.na(df_NoDecoys_Biomart_epost$V4)]
```

```{r Merge Acc Conversion back with PrevSL_trim Data, eval=FALSE, echo=FALSE}
PrevSL_trim_epost <- merge.data.frame(PrevSL_trim, NCBIConvert2, by.x = "GI", by.y = "GI", all=T)

##make new column for complete V4 accessions
#choose the epost ID if available
PrevSL_trim_epost$V4 <- PrevSL_trim_epost$maizegdb.epost
```

```{r Save DF RDS, eval=FALSE, echo=FALSE}
saveRDS(df_NoDecoys_Biomart_epost, "df_NoDecoys_Biomart_epost")
saveRDS(PrevSL_trim_epost, "PrevSL_trim_epost")
```



# Re-start here after cleared environment
## Data import and editing
### Read DF RDS
```{r Read DF RDS}
df_NoDecoys_Biomart_epost <- readRDS("df_NoDecoys_Biomart_epost")
PrevSL_trim_epost2 <- readRDS("PrevSL_trim_epost")
```

### Re-order columns
```{r Re-order columns}
DF <- df_NoDecoys_Biomart_epost
DF<- DF[,c(1,2,42,44,18,3:12)]
colnames(DF)<- c("GI", "RefSeqPep", "UID", "V4", "Protein", "b731", "b732", "b733", "mo171", "mo172", "bm1", "bm2", "acs1", "acs2", "acs3")
```

### geomean functions
```{r geomean functions}
BMgeomean <- function(df){
  x <- NULL
  for(i in 1:nrow(df)){
    v <- as.numeric(df[i, 17:18])
    gm <- geoMean(v, na.rm = T)
    x[i]<-gm
  }
  x
}

PrevSL_BMgeomean <- function(df){
  x <- NULL
  for(i in 1:nrow(df)){
    v <- as.numeric(df[i, 18:20])
    gm <- geoMean(v, na.rm = T)
    x[i]<-gm
  }
  x
}

ACSgeomean <- function(df){
  x <- NULL
  for(i in 1:nrow(df)){
    v <- as.numeric(df[i, 19:21])
    gm <- geoMean(v, na.rm = T)
    x[i]<-gm
  }
  x
}
```

### Set mp, bm/mp, Avgs, and SDS
```{r Set mp, bm/mp, Avgs, and SDS}
DF$mp1 <- rowMeans(DF[,c(6,9)])

DF$bm1.mp1 <- DF$bm1/DF$mp1
DF$bm2.mp1 <- DF$bm2/DF$mp1

DF$acs1.b731 <- DF$acs1/DF$b731
DF$acs2.b732 <- DF$acs2/DF$b732
DF$acs3.b733 <- DF$acs3/DF$b733

DF$avg.bm.mp <- BMgeomean(DF)
DF$avg.acs.b73 <- ACSgeomean(DF)

DF$sds.bm.mp <- rowSds(as.matrix(DF[,17:18]), na.rm = T)
DF$sds.acs.b73 <- rowSds(as.matrix(DF[,19:21]), na.rm = T)
```

### Analyze PrevSL data
```{r analyze PrevSL data}
#Set NAs to 0
PrevSL_trim_epost2$b731[PrevSL_trim_epost2$b731==0]<-NA
PrevSL_trim_epost2$b732[PrevSL_trim_epost2$b732==0]<-NA
PrevSL_trim_epost2$b733[PrevSL_trim_epost2$b733==0]<-NA
PrevSL_trim_epost2$mo171[PrevSL_trim_epost2$mo171==0]<-NA
PrevSL_trim_epost2$mo172[PrevSL_trim_epost2$mo172==0]<-NA
PrevSL_trim_epost2$mo173[PrevSL_trim_epost2$mo173==0]<-NA
PrevSL_trim_epost2$bm1[PrevSL_trim_epost2$bm1==0]<-NA
PrevSL_trim_epost2$bm2[PrevSL_trim_epost2$bm2==0]<-NA
PrevSL_trim_epost2$bm3[PrevSL_trim_epost2$bm3==0]<-NA
# calc. mp values
PrevSL_trim_epost2$mp1 <- rowMeans(PrevSL_trim_epost2[,c(3,6)], na.rm = T)
PrevSL_trim_epost2$mp2 <- rowMeans(PrevSL_trim_epost2[,c(4,7)], na.rm = T)
PrevSL_trim_epost2$mp3 <- rowMeans(PrevSL_trim_epost2[,c(5,8)], na.rm = T)
#calc. ratios
PrevSL_trim_epost2$bm1.mp1 <- PrevSL_trim_epost2$bm1/PrevSL_trim_epost2$mp1
PrevSL_trim_epost2$bm2.mp2 <- PrevSL_trim_epost2$bm2/PrevSL_trim_epost2$mp2
PrevSL_trim_epost2$bm3.mp3 <- PrevSL_trim_epost2$bm3/PrevSL_trim_epost2$mp3
#calc average and standard dev
PrevSL_trim_epost2$avg.bm.mp <- PrevSL_BMgeomean(PrevSL_trim_epost2)
PrevSL_trim_epost2$sds.bm.mp <- rowSds(as.matrix(PrevSL_trim_epost2[,18:20]), na.rm = T)
```

```{r write table PrevSL l2fc for Corn Cyc analyses, eval=FALSE, echo=FALSE}
write.table(na.omit(PrevSL_trim_epost2[,c(14,23)]), "Prot_SL.txt", sep="\t", row.names = F, col.names = F)
```
### Subset to sig, above, and below
```{r Subset to sig, above, and below}
DF.acs.sig <- DF[(DF$sds.acs.b73<0.1),]
DF.bm.sig <- DF[(DF$sds.bm.mp<0.1),]

DF.acs.sig.10above <- DF.acs.sig[(DF.acs.sig$avg.acs.b73>1.1),]
DF.bm.sig.10above <- DF.bm.sig[(DF.bm.sig$avg.bm.mp>1.1),]

DF.acs.sig.10below <- DF.acs.sig[(DF.acs.sig$avg.acs.b73<0.9),]
DF.bm.sig.10below <- DF.bm.sig[(DF.bm.sig$avg.bm.mp<0.9),]

PrevSL_trim_epost2.bm.sig <- PrevSL_trim_epost2[(PrevSL_trim_epost2$sds.bm.mp<0.1),]
PrevSL_trim_epost2.bm.sig.10above <- PrevSL_trim_epost2.bm.sig[(PrevSL_trim_epost2.bm.sig$avg.bm.mp>1.1),]
PrevSL_trim_epost2.bm.sig.10below <- PrevSL_trim_epost2.bm.sig[(PrevSL_trim_epost2.bm.sig$avg.bm.mp<0.9),]
```

### calculate Log2(fold change)
```{r calculate Log2(fold change)}
DF$avg.bm.mp.l2fc <- log2(DF$avg.bm.mp)
DF$avg.acs.b73.l2fc <- log2(DF$avg.acs.b73)

DF$bm1.mp1.l2fc <- log2(DF$bm1.mp1)
DF$bm2.mp1.l2fc <- log2(DF$bm2.mp1)

DF$acs1.b731.l2fc <- log2(DF$acs1.b731)
DF$acs2.b732.l2fc <- log2(DF$acs2.b732)
DF$acs3.b733.l2fc <- log2(DF$acs3.b733)

PrevSL_trim_epost2$avg.bm.mp.l2fc <- log2(PrevSL_trim_epost2$avg.bm.mp)
PrevSL_trim_epost2$bm1.mp1.l2fc <- log2(PrevSL_trim_epost2$bm1.mp1)
PrevSL_trim_epost2$bm2.mp2.l2fc <- log2(PrevSL_trim_epost2$bm2.mp2)
PrevSL_trim_epost2$bm3.mp3.l2fc <- log2(PrevSL_trim_epost2$bm3.mp3)
```

### Subset without duplicate UIDs for KEGG
```{r Subset without duplicate UIDs for KEGG}
DF_NoDupUID <- DF[!(duplicated(DF$UID) | is.na(DF$UID)),]

nrow(DF)
nrow(DF_NoDupUID)
```

```{r Save l2fc data for CornCyc analysis, eval=FALSE, echo=FALSE}
DF_NoDupUID.txt <- DF_NoDupUID[,c(4,27)]
write.table(DF_NoDupUID.txt, "Prot_acs.txt", sep="\t", row.names = F, col.names = F)
```

### Subset PrevSL without duplicate UIDs for KEGG
```{r Subset PrevSL without duplicate UIDs for KEGG}
PrevSL_trim_epost2_NoDupUID <- PrevSL_trim_epost2[!(duplicated(PrevSL_trim_epost2$UID) | is.na(PrevSL_trim_epost2$UID)),]

nrow(PrevSL_trim_epost2)
nrow(PrevSL_trim_epost2_NoDupUID)
```

### subset to hyb and acs l2fc DFs for KEGG
```{r subset to hyb and acs l2fc DFs for KEGG}
DF.bm.l2fc <- DF_NoDupUID[,28:29]
DF.acs.l2fc <- DF_NoDupUID[,30:32]
DF.bm.AND.acs.l2fc <- DF_NoDupUID[,28:32]

rownames(DF.bm.l2fc) <- DF_NoDupUID$UID
rownames(DF.acs.l2fc) <- DF_NoDupUID$UID
rownames(DF.bm.AND.acs.l2fc) <- DF_NoDupUID$UID

#Remove the one row of NA - dont know where this came from (?)
DF.acs.sig.10below <- DF.acs.sig.10below[!(is.na(DF.acs.sig.10below$GI)),]
DF.acs.sig.10above <- DF.acs.sig.10above[!(is.na(DF.acs.sig.10above$GI)),]
```

### subset PrevSL to hyb and acs l2fc DFs for KEGG
```{r subset PrevSL to hyb and acs l2fc DFs for KEGG}
PrevSL_trim_epost2.bm.l2fc <- PrevSL_trim_epost2_NoDupUID[,24:26]
rownames(PrevSL_trim_epost2.bm.l2fc) <- PrevSL_trim_epost2_NoDupUID$UID

PrevSL_trim_epost2.bm.l2fc<- (na.omit(PrevSL_trim_epost2.bm.l2fc))
```


```{r Venn Diagrams, eval=FALSE, echo=FALSE}
VennDiagram::venn.diagram(list("BxM"=DF.bm.sig.10above$GI, "acs2/6"=DF.acs.sig.10above$GI), main = "Proteins 10% above expected (sd<0.1)", main.cex = 2, cex=2, cat.cex=1.5, filename = "DF10aboveVenn.png", ext.text=F, fill=c("orange", "yellow"), cat.pos=c(0,0), main.pos = c(0.5,0.95))

VennDiagram::venn.diagram(list("BxM"=DF.bm.sig.10below$GI, "acs2/6"=DF.acs.sig.10below$GI), main = "Proteins 10% below expected (sd<0.1)",main.cex = 2, cex=2, cat.cex=1.5, filename = "DF10belowVenn.png", ext.text=F, fill=c("orange", "yellow"), cat.pos=c(0,0), main.pos = c(0.5,0.95))
```
### Subset DFs to discrete sections of Venn Diagrams
```{r Subset DFs to discrete sections of Venn Diagrams}
DF.bm.AND.acs.sig.10above <- DF.bm.sig.10above[(DF.bm.sig.10above$GI%in%DF.acs.sig.10above$GI),]
DF.bm.NOT.acs.sig.10above <- DF.bm.sig.10above[!(DF.bm.sig.10above$GI%in%DF.acs.sig.10above$GI),]
DF.acs.NOT.bm.sig.10above <- DF.acs.sig.10above[!(DF.acs.sig.10above$GI%in%DF.bm.sig.10above$GI),]

DF.bm.AND.acs.sig.10below <- DF.bm.sig.10below[(DF.bm.sig.10below$GI%in%DF.acs.sig.10below$GI),]
DF.bm.NOT.acs.sig.10below <- DF.bm.sig.10below[!(DF.bm.sig.10below$GI%in%DF.acs.sig.10below$GI),]
DF.acs.NOT.bm.sig.10below <- DF.acs.sig.10below[!(DF.acs.sig.10below$GI%in%DF.bm.sig.10below$GI),]

#check that we got everything
(nrow(DF.bm.AND.acs.sig.10above)+nrow(DF.bm.NOT.acs.sig.10above)+nrow(DF.acs.NOT.bm.sig.10above))==(length(unique(c(DF.bm.sig.10above$GI,DF.acs.sig.10above$GI))))

(nrow(DF.bm.AND.acs.sig.10below)+nrow(DF.bm.NOT.acs.sig.10below)+nrow(DF.acs.NOT.bm.sig.10below))==(length(unique(c(DF.bm.sig.10below$GI,DF.acs.sig.10below$GI))))
```


# KEGG
## Pathview and GAGE to create KEGG maps
### Define gsets and run gage on acs and hyb
```{r Define gsets and run gage on acs and hyb}
zma <- kegg.gsets(species = "zma", id.type = "entrez")

keggres_HYB_DF <- gage(DF.bm.l2fc, gsets = zma$kg.sets, samp = c(1:2), same.dir = T)
keggres_ACS_DF <- gage(DF.acs.l2fc, gsets = zma$kg.sets, samp = c(1:3), same.dir = T)
keggres_HYB.AND.ACS_DF <- gage(DF.bm.AND.acs.l2fc, gsets = zma$kg.sets, samp = c(1:5), same.dir = T)
keggres_PrevSL_DF <- gage(PrevSL_trim_epost2.bm.l2fc, gsets = zma$kg.sets, samp = c(1:3), same.dir = F)
```
```{r}
write.csv(keggres_PrevSL_DF$greater, "keggres_PrevSL_DF.csv")
```

### PVfun
```{r PVfun}
PVfun <- function(keggres, foldchangev){
  dir.create(paste0((deparse(substitute(keggres))), "_",(deparse(substitute(foldchangev))),"/"))
setwd(paste0((deparse(substitute(keggres))), "_",(deparse(substitute(foldchangev))),"/"))
keggres_df = as.data.frame(keggres)
keggres_df_sig = na.omit(keggres_df[(keggres_df$p.val<0.05),])

V = rownames(keggres_df_sig)
Va = substr(V, start = 1, stop = 8)
Vb = substr(V, start = 10, stop = 100)
Vm =cbind(Va, Vb)

for(i in 1:nrow(Vm)){
  pathview(gene.data=foldchangev, pathway.id=Vm[i,1], species = "zma", out.suffix = (paste0(Vm[i,2], (deparse(substitute(keggres))))))
  }
}
```



```{r PVfun run, eval=FALSE, echo=FALSE}
PVfun(keggres_PrevSL_DF$greater, PrevSL_trim_epost2.bm.l2fc)
PVfun(keggres_PrevSL_DF$less, PrevSL_trim_epost2.bm.l2fc)

PVfun(keggres_HYB_DF$greater, DF.bm.l2fc)
PVfun(keggres_HYB_DF$less, DF.bm.l2fc)

PVfun(keggres_ACS_DF$greater, DF.acs.l2fc)
PVfun(keggres_ACS_DF$less, DF.acs.l2fc)

pathview(PrevSL_trim_epost2.bm.l2fc, pathway.id = "zma00010", species = "zma", out.suffix = "keggres_PrevSL_DF$less_Glycolysis")
```
```{r}
PVfun(keggres_HYB.AND.ACS_DF$less, DF.bm.AND.acs.l2fc)
```


### Check which genes are significantly altered in a given KEGG term
```{r SelectSigKEGGgenes function}
SelectSigKEGGgenes <- function(zma.kgsets.term, l2fc){
  x <- gage::essGene(zma.kgsets.term, l2fc)
  x$UID <- rownames(x)
  x2 <- merge.data.frame(x, DF, by.x = "UID", by.y = "UID")
  x2
}
```
```{r SelectSigKEGGgenes run}
SelectSigKEGGgenes(zma$kg.sets$`zma04712 Circadian rhythm - plant`, DF.bm.l2fc)
```



```{r Make .png images of KEGG pathway enrichment dataframes, eval=FALSE, echo=FALSE}
ExportKeggDFpng.HYB<- function(keggDF){
  dir.create("KEGG.DFs/")
  setwd("KEGG.DFs/")
keggDF2 <- as.data.frame(keggDF)
keggDF2$KEGG <- rownames(keggDF2)
keggDF2 <- keggDF2[1:10,c(8,1:7)]
png((paste0(c(deparse(substitute(keggDF))),".png")), height=300, width=1200)
p<-tableGrob(keggDF2, rows = c())
grid.arrange(p)
dev.off()
}
ExportKeggDFpng.ACS<- function(keggDF){
  dir.create("KEGG.DFs/")
  setwd("KEGG.DFs/")
keggDF2 <- as.data.frame(keggDF)
keggDF2$KEGG <- rownames(keggDF2)
keggDF2 <- keggDF2[1:10,c(9,1:8)]
png((paste0(c(deparse(substitute(keggDF))),".png")), height=300, width=1200)
p<-tableGrob(keggDF2, rows = c())
grid.arrange(p)
dev.off()
}
ExportKeggDFpng.HYB.AND.ACS<- function(keggDF){
  dir.create("KEGG.DFs/")
  setwd("KEGG.DFs/")
keggDF2 <- as.data.frame(keggDF)
keggDF2$KEGG <- rownames(keggDF2)
keggDF2 <- keggDF2[1:10,c(11,1:10)]
png((paste0(c(deparse(substitute(keggDF))),".png")), height=300, width=1200)
p<-tableGrob(keggDF2, rows = c())
grid.arrange(p)
dev.off()
}
```
```{r}
ExportKeggDFpng.HYB.AND.ACS(keggres_HYB.AND.ACS_DF$greater)
```


```{r KEGG:AminoAcidBio, eval=FALSE, echo=FALSE}
BiosynthesisAAs <- pathview(gene.data = DF.bm.l2fc, pathway.id = "zma01230", species="zma", out.suffix = "BiosynthesisAAs_HYB", keys.align = "y", kegg.native = F, match.data = F, multi.state = T, same.layer = T, cex=0.125, afactor=3, map.null = T, expand.node = T)
```



# GO analysis
## TopGO and Gamer

```{r gamer_ReadIn, include=FALSE, eval=FALSE, echo=FALSE}
# Read in Maize GAMER GO dataset, which lists V4 accessions with all associated GO terms (Wimalanathan et al. 2018) downloaded from doi.org/10.7946/P2M925
#unzip("maize.B73.AGPv4.aggregate.gaf.zip")
GAMER <- read.delim("maize.B73.AGPv4.aggregate.gaf", sep = "\t", header = FALSE, stringsAsFactors = F)
colnames(GAMER) <- c("db", "db_object_id", "db_object_symbol", "qualifier", "term_accession", "db_reference", "evidence_code", "with", "aspect", "db_object_name", "db_object_synonym", "db_object_type", "taxon", "date", "assigned_by", "annotation_extension", "gene_product_form_id")
saveRDS(GAMER, "GAMER")
```
### gamer cut
```{r gamer cut}
GAMER <- readRDS("GAMER")
gamer <- GAMER[-(1:2),]
gamer$Term <- Term(as.character(gamer$term_accession))

#Make gamer dataframe trimmed to only proteins detected in this run to use as background control set for enrichment analyses (input for "GamerCut" in GOanalysisGodata function)
GamerCut <- gamer[(gamer$db_object_id %in% DF$V4),]
GamerCut_PrevSL <- gamer[(gamer$db_object_id %in% PrevSL_trim_epost2$V4),]
```

### define GO:photosynthesis genes and GO:ribosome genes
```{r define GO:photosynthesis genes and GO:ribosome genes}
go.photosynthesis <- na.omit(gamer[(gamer$Term=="photosynthesis"),])
accessions.go.photosynthesis <- go.photosynthesis$db_object_id

go.ribosome <- na.omit(gamer[(gamer$Term=="ribosome"),])
accessions.go.ribosome <- go.ribosome$db_object_id
```

### GOanalysis functions
```{r GOanalysis functions}
## Build GOdata object
# EnrichedDF = DF with V4 accessions for GOIs in column named "V4"
# GamerCut = GAMER dataframe trimmed to control set
# ont = "BP", "MF", or "CC"
GOanalysisGodata <- function(EnrichedDF, GamerCut, ont, nodesize = 1){
  gene2GO_TissueCut <- split((as.character(GamerCut$term_accession)),GamerCut$db_object_id)
  gene2GOb_TissueCut <- gene2GO_TissueCut[-2]
  str(head(gene2GOb_TissueCut))
  geneNames_tissuecut <- names(gene2GOb_TissueCut)
  myInterestingGenes <- EnrichedDF$V4
  myInterestingGenes <- na.omit(myInterestingGenes)
  geneList <- factor(as.integer(geneNames_tissuecut %in% myInterestingGenes))
  names(geneList) <- geneNames_tissuecut
  GOdata <- new("topGOdata", ontology = ont, allGenes = geneList, annot = annFUN.gene2GO, nodeSize=nodesize, gene2GO = gene2GOb_TissueCut)
  GOdata
}

## GO analysis function to generate dataframe summary of top 20 of GO terms
# GOdata = Godata object (output of GoanalysisGodata function)

GOanalysisDF <- function(GOdata){
resultFis <- runTest(GOdata, algorithm = "classic", statistic = "fisher")
test.statF <- new("classicCount", testStatistic = GOFisherTest, name = "Fisher test")
resultFisher <- getSigGroups(GOdata, test.statF)
test.statKS <- new("classicScore", testStatistic = GOKSTest, name = "KS tests")
resultKS <- getSigGroups(GOdata, test.statKS)
test.statRW <- new("weightCount", testStatistic = GOFisherTest, name = "Fisher test", sigRatio = "ratio")
resultWeight <- getSigGroups(GOdata, test.statRW)
DF <- GenTable(GOdata, classic = resultFis, KS = resultKS, weight = resultWeight, orderBy = "classic", ranksOf = "classic", topNodes = 100)
DF
}

GOanalysisDF.list <- function(l){
  dir.create("GOdata.DFs/")
  setwd("GOdata.DFs/")
  l2 <- list(NULL)
  for(i in 1:length(l)){
   DF <- GOanalysisDF(l[[i]])
  png((paste0((names(l[i])), ".png")), height = 300, width=900)
  p<-tableGrob(DF[1:10,], rows = c())
  grid.arrange(p)
  dev.off()
  l2[[i]]<-DF
  }
  names(l2)<- names(l)
  l2
}

## GO analysis function to build map of top GO terms, output to pdf
# GOdata = Godata object (output of GoanalysisGodata function)
GOanalysisMap <- function(GOdata, nodes=10){
  resultFis <- runTest(GOdata, algorithm = "classic", statistic = "fisher")
  printGraph(GOdata, resultFis, firstSigNodes = nodes, fn.prefix = (paste0(c(deparse(substitute(GOdata))),".png")), useInfo = "all", pdfSW = TRUE)
}
```

```{r GO analyses, eval=FALSE, echo=FALSE}
#above
DF.acs.sig.10above.godataBP <- GOanalysisGodata(DF.acs.sig.10above, GamerCut, "BP")
DF.bm.sig.10above.godataBP <- GOanalysisGodata(DF.bm.sig.10above, GamerCut, "BP")

DF.acs.sig.10above.godataCC <- GOanalysisGodata(DF.acs.sig.10above, GamerCut, "CC")
DF.bm.sig.10above.godataCC <- GOanalysisGodata(DF.bm.sig.10above, GamerCut, "CC")

DF.acs.sig.10above.godataMF <- GOanalysisGodata(DF.acs.sig.10above, GamerCut, "MF")
DF.bm.sig.10above.godataMF <- GOanalysisGodata(DF.bm.sig.10above, GamerCut, "MF")

#below
DF.acs.sig.10below.godataBP <- GOanalysisGodata(DF.acs.sig.10below, GamerCut, "BP")
DF.bm.sig.10below.godataBP <- GOanalysisGodata(DF.bm.sig.10below, GamerCut, "BP")

DF.acs.sig.10below.godataCC <- GOanalysisGodata(DF.acs.sig.10below, GamerCut, "CC")
DF.bm.sig.10below.godataCC <- GOanalysisGodata(DF.bm.sig.10below, GamerCut, "CC")

DF.acs.sig.10below.godataMF <- GOanalysisGodata(DF.acs.sig.10below, GamerCut, "MF")
DF.bm.sig.10below.godataMF <- GOanalysisGodata(DF.bm.sig.10below, GamerCut, "MF")

GOdata.list <- list("DF.acs.sig.10above.godataBP"=DF.acs.sig.10above.godataBP, "DF.bm.sig.10above.godataBP"=DF.bm.sig.10above.godataBP, "DF.acs.sig.10above.godataCC"=DF.acs.sig.10above.godataCC, "DF.bm.sig.10above.godataCC"=DF.bm.sig.10above.godataCC, "DF.acs.sig.10above.godataMF"=DF.acs.sig.10above.godataMF,"DF.bm.sig.10above.godataMF"=DF.bm.sig.10above.godataMF,
"DF.acs.sig.10below.godataBP"=DF.acs.sig.10below.godataBP, "DF.bm.sig.10below.godataBP"=DF.bm.sig.10below.godataBP, "DF.acs.sig.10below.godataCC"=DF.acs.sig.10below.godataCC, "DF.bm.sig.10below.godataCC"=DF.bm.sig.10below.godataCC, "DF.acs.sig.10below.godataMF"=DF.acs.sig.10below.godataMF,"DF.bm.sig.10below.godataMF"=DF.bm.sig.10below.godataMF)
#Save GOdata list
saveRDS(GOdata.list, "GOdata.list")
#Build GO term enrichment tables
GO.DF.l <- GOanalysisDF.list(GOdata.list)
#Save list of GO term enrichment tables
saveRDS(GO.DF.l, "GO.DF.l")
```




### Read back in analyzed data
```{r readRDS}
#Load back in GOdata list and GO term enrichment table list
GOdata.list <- readRDS("GOdata.list")
GO.DF.l <- readRDS("GO.DF.l")
```

### printDFs function
```{r printDFs function}
printDFs <- function(l){
for(i in 1:length(l)){
  print(names(l[i]))
  print((l[[i]][1:10,1:6]))}
}
```

### GO-term enrichment tables
```{r GO-term enrichment tablesøØ}
printDFs(GO.DF.l)
```


```{r GO analysis venn diagram sections, eval=FALSE, echo=FALSE}
#above
DF.bm.AND.acs.sig.10above_GodataBP <- GOanalysisGodata(DF.bm.AND.acs.sig.10above, GamerCut, "BP")
DF.bm.NOT.acs.sig.10above_GodataBP <- GOanalysisGodata(DF.bm.NOT.acs.sig.10above, GamerCut, "BP")
DF.acs.NOT.bm.sig.10above_GodataBP <- GOanalysisGodata(DF.acs.NOT.bm.sig.10above, GamerCut, "BP")

DF.bm.AND.acs.sig.10above_GodataCC <- GOanalysisGodata(DF.bm.AND.acs.sig.10above, GamerCut, "CC")
DF.bm.NOT.acs.sig.10above_GodataCC <- GOanalysisGodata(DF.bm.NOT.acs.sig.10above, GamerCut, "CC")
DF.acs.NOT.bm.sig.10above_GodataCC <- GOanalysisGodata(DF.acs.NOT.bm.sig.10above, GamerCut, "CC")

DF.bm.AND.acs.sig.10above_GodataMF <- GOanalysisGodata(DF.bm.AND.acs.sig.10above, GamerCut, "MF")
DF.bm.NOT.acs.sig.10above_GodataMF <- GOanalysisGodata(DF.bm.NOT.acs.sig.10above, GamerCut, "MF")
DF.acs.NOT.bm.sig.10above_GodataMF <- GOanalysisGodata(DF.acs.NOT.bm.sig.10above, GamerCut, "MF")

#below
DF.bm.AND.acs.sig.10below_GodataBP <- GOanalysisGodata(DF.bm.AND.acs.sig.10below, GamerCut, "BP")
DF.bm.NOT.acs.sig.10below_GodataBP <- GOanalysisGodata(DF.bm.NOT.acs.sig.10below, GamerCut, "BP")
DF.acs.NOT.bm.sig.10below_GodataBP <- GOanalysisGodata(DF.acs.NOT.bm.sig.10below, GamerCut, "BP")

DF.bm.AND.acs.sig.10below_GodataCC <- GOanalysisGodata(DF.bm.AND.acs.sig.10below, GamerCut, "CC")
DF.bm.NOT.acs.sig.10below_GodataCC <- GOanalysisGodata(DF.bm.NOT.acs.sig.10below, GamerCut, "CC")
DF.acs.NOT.bm.sig.10below_GodataCC <- GOanalysisGodata(DF.acs.NOT.bm.sig.10below, GamerCut, "CC")

DF.bm.AND.acs.sig.10below_GodataMF <- GOanalysisGodata(DF.bm.AND.acs.sig.10below, GamerCut, "MF")
DF.bm.NOT.acs.sig.10below_GodataMF <- GOanalysisGodata(DF.bm.NOT.acs.sig.10below, GamerCut, "MF")
DF.acs.NOT.bm.sig.10below_GodataMF <- GOanalysisGodata(DF.acs.NOT.bm.sig.10below, GamerCut, "MF")

GOdata.venn.list <- list("DF.bm.AND.acs.sig.10above_GodataBP"=DF.bm.AND.acs.sig.10above_GodataBP,"DF.bm.NOT.acs.sig.10above_GodataBP"=DF.bm.NOT.acs.sig.10above_GodataBP, "DF.acs.NOT.bm.sig.10above_GodataBP"=DF.acs.NOT.bm.sig.10above_GodataBP, "DF.bm.AND.acs.sig.10above_GodataCC"=DF.bm.AND.acs.sig.10above_GodataCC, "DF.bm.NOT.acs.sig.10above_GodataCC"=DF.bm.NOT.acs.sig.10above_GodataCC, "DF.acs.NOT.bm.sig.10above_GodataCC"=DF.acs.NOT.bm.sig.10above_GodataCC, "DF.bm.AND.acs.sig.10above_GodataMF"=DF.bm.AND.acs.sig.10above_GodataMF, "DF.bm.NOT.acs.sig.10above_GodataMF"=DF.bm.NOT.acs.sig.10above_GodataMF, "DF.acs.NOT.bm.sig.10above_GodataMF"=DF.acs.NOT.bm.sig.10above_GodataMF, "DF.bm.AND.acs.sig.10below_GodataBP"=DF.bm.AND.acs.sig.10below_GodataBP, "DF.bm.NOT.acs.sig.10below_GodataBP"=DF.bm.NOT.acs.sig.10below_GodataBP, "DF.acs.NOT.bm.sig.10below_GodataBP"=DF.acs.NOT.bm.sig.10below_GodataBP, "DF.bm.AND.acs.sig.10below_GodataCC"=DF.bm.AND.acs.sig.10below_GodataCC, "DF.bm.NOT.acs.sig.10below_GodataCC"=DF.bm.NOT.acs.sig.10below_GodataCC, "DF.acs.NOT.bm.sig.10below_GodataCC"=DF.acs.NOT.bm.sig.10below_GodataCC, "DF.bm.AND.acs.sig.10below_GodataMF"=DF.bm.AND.acs.sig.10below_GodataMF, "DF.bm.NOT.acs.sig.10below_GodataMF"=DF.bm.NOT.acs.sig.10below_GodataMF, "DF.acs.NOT.bm.sig.10below_GodataMF"=DF.acs.NOT.bm.sig.10below_GodataMF)
#Save GOdata list
saveRDS(GOdata.venn.list, "GOdata.venn.list")
#Build GO term enrichment tables
GO.venn.DF.l <- GOanalysisDF.list(GOdata.venn.list)
#Save list of GO term enrichment tables
saveRDS(GO.venn.DF.l, "GO.venn.DF.l")
```

### Read back in analyzed data
```{r readRDS}
#Load back in GOdata list and GO term enrichment table list
GOdata.venn.list <- readRDS("GOdata.venn.list")
GO.venn.DF.l <- readRDS("GO.venn.DF.l")
```
### Venn diagram discrete sections GO-term enrichments
```{r}
printDFs(GO.venn.DF.l)
```

### Select Significant genes from given GO term in a GOdata object and return their proteins
```{rSelectSigGOgenes function}
SelectSigGOgenes <- function(GOdata, GOterm){
 df <- data.frame(gene=(topGO::genesInTerm(GOdata, GOterm)), score=(topGO::scoresInTerm(GOdata, GOterm))) 
# df.s <- df[]
 colnames(df) <- c("gene", "score")
 df$gene <- as.character(df$gene)
 df.s <- df[(df$score==2),]
 df.s.prot <- merge.data.frame(df.s, DF, by.x = "gene", by.y = "V4")
 df.s.prot
}

```
```{rrSelectSigGOgenes run}
SelectSigGOgenes(GOdata.list$DF.acs.sig.10below.godataBP, "GO:0010025")
```


# Distance matrices to analyze bio replicates
## Build distance matrix of bio reps
```{r}
#Build distance matrix of bio reps
df_NoDecoys_Biomart_epost_bioreps <- df_NoDecoys_Biomart_epost
df_NoDecoys_Biomart_epost_bioreps <- df_NoDecoys_Biomart_epost_bioreps[,c(3:12)]
colnames(df_NoDecoys_Biomart_epost_bioreps)<- c("b73.1", "b73.2", "b73.3", "mo17.1", "mo17.2", "BM.1", "BM.2", "acs.1", "acs.2", "acs.3")
df_NoDecoys_Biomart_epost_bioreps <- t(df_NoDecoys_Biomart_epost_bioreps)
dist_bioreps <- dist(df_NoDecoys_Biomart_epost_bioreps, method = "euclidean")
dist_bioreps
```
## Plot distance matrix 
```{r}
#Plot distance matrix - bio reps
res.dist_bioreps <- factoextra::get_dist(df_NoDecoys_Biomart_epost_bioreps, stand = F, method = "euclidian")
factoextra::fviz_dist(res.dist_bioreps, 
   gradient = list(low = "#00AFBB", mid = "white", high = "#FC4E07"), order = T)

ggsave("bioreps_dist.png")
```
## build heirarchical clustering
```{r}
#build heirarchical clustering - bio reps
hc_bioreps<- hclust(dist_bioreps, method = "ward.D2")
hcd_bioreps <- as.dendrogram(hc_bioreps)
plot(hcd_bioreps, type = "rectangle", ylab = "height")
```

## Build distance matrix of bio reps - plastid-encoded
```{r}
#Build distance matrix of bio reps
df_NoDecoys_Biomart_epost_bioreps_plastid <- df_NoDecoys_Biomart_epost
df_NoDecoys_Biomart_epost_bioreps_plastid <- df_NoDecoys_Biomart_epost_bioreps_plastid[grep("NP_04",df_NoDecoys_Biomart_epost_bioreps_plastid$Protein),]
df_NoDecoys_Biomart_epost_bioreps_plastid <- df_NoDecoys_Biomart_epost_bioreps_plastid[,c(3:12)]
colnames(df_NoDecoys_Biomart_epost_bioreps_plastid)<- c("b73.1", "b73.2", "b73.3", "mo17.1", "mo17.2", "BM.1", "BM.2", "acs.1", "acs.2", "acs.3")
df_NoDecoys_Biomart_epost_bioreps_plastid <- t(df_NoDecoys_Biomart_epost_bioreps_plastid)
dist_bioreps_plastid <- dist(df_NoDecoys_Biomart_epost_bioreps_plastid, method = "euclidean")
dist_bioreps_plastid
```
## Plot distance matrix - plastid-encoded
```{r}
#Plot distance matrix - bio reps
res.dist_bioreps <- factoextra::get_dist(df_NoDecoys_Biomart_epost_bioreps_plastid, stand = F, method = "euclidian")
factoextra::fviz_dist(res.dist_bioreps, 
   gradient = list(low = "#00AFBB", mid = "white", high = "#FC4E07"), order = T)
ggsave("bioreps_plastid_dist.png")
```
## build heirarchical clustering - plastid-encoded
```{r}
#build heirarchical clustering - bio reps
hc_bioreps_plastid<- hclust(dist_bioreps_plastid, method = "ward.D2")
hcd_bioreps_plastid <- as.dendrogram(hc_bioreps_plastid)
plot(hcd_bioreps_plastid, type = "rectangle", ylab = "height")
```

## Build distance matrix of bio reps - GO:photosynthesis
```{r}
#Build distance matrix of bio reps
df_NoDecoys_Biomart_epost_bioreps_go.photo<- df_NoDecoys_Biomart_epost
df_NoDecoys_Biomart_epost_bioreps_go.photo <- df_NoDecoys_Biomart_epost_bioreps_go.photo[(df_NoDecoys_Biomart_epost_bioreps_go.photo$V4%in%accessions.go.photosynthesis),]
df_NoDecoys_Biomart_epost_bioreps_go.photo <- df_NoDecoys_Biomart_epost_bioreps_go.photo[,c(3:12)]
colnames(df_NoDecoys_Biomart_epost_bioreps_go.photo)<- c("b73.1", "b73.2", "b73.3", "mo17.1", "mo17.2", "BM.1", "BM.2", "acs.1", "acs.2", "acs.3")
df_NoDecoys_Biomart_epost_bioreps_go.photo <- t(df_NoDecoys_Biomart_epost_bioreps_go.photo)
dist_bioreps_go.photo <- dist(df_NoDecoys_Biomart_epost_bioreps_go.photo, method = "euclidean")
dist_bioreps_go.photo
```
## Plot distance matrix - GO:photosynthesis
```{r}
#Plot distance matrix - bio reps
res.dist_bioreps <- factoextra::get_dist(df_NoDecoys_Biomart_epost_bioreps_go.photo, stand = F, method = "euclidian")
factoextra::fviz_dist(res.dist_bioreps, 
   gradient = list(low = "#00AFBB", mid = "white", high = "#FC4E07"))
ggsave("bioreps_nuclear_GO_photo_dist.png")
```
## build heirarchical clustering - GO:photosynthesis
```{r}
#build heirarchical clustering - bio reps
hc_bioreps_go.photo<- hclust(dist_bioreps_go.photo)
hcd_bioreps_go.photo <- as.dendrogram(hc_bioreps_go.photo)
plot(hcd_bioreps_go.photo, type = "rectangle", ylab = "height")
```

## Build distance matrix of bio reps - "ribosomal protein"
```{r}
#Build distance matrix of bio reps
df_NoDecoys_Biomart_epost_bioreps_go.ribosome<- df_NoDecoys_Biomart_epost
df_NoDecoys_Biomart_epost_bioreps_go.ribosome <- df_NoDecoys_Biomart_epost_bioreps_go.ribosome[grep("ribosomal protein",df_NoDecoys_Biomart_epost_bioreps_go.ribosome$Protein),]
df_NoDecoys_Biomart_epost_bioreps_go.ribosome <- df_NoDecoys_Biomart_epost_bioreps_go.ribosome[,c(3:12)]
colnames(df_NoDecoys_Biomart_epost_bioreps_go.ribosome)<- c("b73.1", "b73.2", "b73.3", "mo17.1", "mo17.2", "BM.1", "BM.2", "acs.1", "acs.2", "acs.3")
df_NoDecoys_Biomart_epost_bioreps_go.ribosome <- t(df_NoDecoys_Biomart_epost_bioreps_go.ribosome)
dist_bioreps_go.ribosome <- dist(df_NoDecoys_Biomart_epost_bioreps_go.ribosome, method = "euclidean", diag=T, upper=T)
dist_bioreps_go.ribosome
```
## Plot distance matrix - "ribosomal protein"
```{r}
#Plot distance matrix - bio reps
res.dist_bioreps <- factoextra::get_dist(df_NoDecoys_Biomart_epost_bioreps_go.ribosome, stand = F, method = "euclidian")
factoextra::fviz_dist(res.dist_bioreps, 
   gradient = list(low = "#00AFBB", mid = "white", high = "#FC4E07"))
ggsave("bioreps_nuclear_GO_ribosome_dist.png")
```
## build heirarchical clustering - "ribosomal protein"
```{r} 
#build heirarchical clustering - bio reps
hc_bioreps_go.ribosome<- hclust(dist_bioreps_go.ribosome)
hcd_bioreps_go.ribosome <- as.dendrogram(hc_bioreps_go.ribosome)
plot(hcd_bioreps_go.ribosome, type = "rectangle", ylab = "height")
```


# heatmaps 
```{r}
library(RColorBrewer)
```
## build matrices
```{r}
dist_bioreps_go.ribosome.m <- as.matrix(dist_bioreps_go.ribosome)
dist_bioreps_go.photo.m <- as.matrix(dist_bioreps_go.photo)
dist_bioreps_plastid.m <- as.matrix(dist_bioreps_plastid)
dist_bioreps.m <- as.matrix(dist_bioreps)
```
## heatmap:all
```{r}
heatmap(dist_bioreps.m, col =colorRampPalette(brewer.pal(8, "Blues"))(25), symm = T)
```
## heatmap:plastid-encoded
```{r}
heatmap(dist_bioreps_plastid.m, col =colorRampPalette(brewer.pal(8, "Blues"))(25), symm = T)
```
## heatmap:GO:photosynthesis
```{r}
heatmap(dist_bioreps_go.photo.m, col =colorRampPalette(brewer.pal(8, "Blues"))(25), symm = T)
```
## heatmap:ribosome
```{r}
heatmap(dist_bioreps_go.ribosome.m, col =colorRampPalette(brewer.pal(8, "Blues"))(25), symm = T)
```


# heatmaps of individual protein expression
## heatmap:all
```{r}
df_NoDecoys_Biomart_epost_bioreps.t <- t(df_NoDecoys_Biomart_epost_bioreps)
heatmap(df_NoDecoys_Biomart_epost_bioreps.t)
```
## heatmap:plastid-encoded
```{r}
df_NoDecoys_Biomart_epost_bioreps_plastid.t <- t(df_NoDecoys_Biomart_epost_bioreps_plastid)
heatmap(df_NoDecoys_Biomart_epost_bioreps_plastid.t)
```
## heatmap:GO:photosynthesis
```{r}
df_NoDecoys_Biomart_epost_bioreps_go.photo.t <- t(df_NoDecoys_Biomart_epost_bioreps_go.photo)
heatmap(df_NoDecoys_Biomart_epost_bioreps_go.photo.t)
```
## heatmap:ribosome
```{r}
df_NoDecoys_Biomart_epost_bioreps_go.ribosome.t <- t(df_NoDecoys_Biomart_epost_bioreps_go.ribosome)
heatmap(df_NoDecoys_Biomart_epost_bioreps_go.ribosome.t)
```



# PlotExp function
```{r PlotExp function}
PlotExp <- function(V4acc){
b73 <- df_NoDecoys_Biomart_epost[((as.character(df_NoDecoys_Biomart_epost$V4))==V4acc), 3:5]
mo17 <- df_NoDecoys_Biomart_epost[((as.character(df_NoDecoys_Biomart_epost$V4))==V4acc), 6:7]
hyb <- df_NoDecoys_Biomart_epost[((as.character(df_NoDecoys_Biomart_epost$V4))==V4acc), 8:9]
acs <- df_NoDecoys_Biomart_epost[((as.character(df_NoDecoys_Biomart_epost$V4))==V4acc), 10:12]
all4 <- c(as.numeric(b73[1,]), as.numeric(mo17[1,]), as.numeric(hyb[1,]), as.numeric(acs[1,]))
all4df <- data.frame(sample=(c("b73.1", "b73.2", "b73.3", "mo17.1", "mo17.2", "hyb.1", "hyb.2", "acs.1", "acs.2", "acs.3")), TMT=all4)
all4df$sample <- factor(all4df$sample, levels = all4df$sample)
ggplot(data=all4df, aes(x=sample, y=TMT, width=0.75)) + geom_bar(stat="identity", fill = c("blue3", "blue3", "blue3", "red3", "red3",  "purple4", "purple4", "green3", "green3", "green3")) + labs(title=V4acc)
}
```
## Plotting genes
```{r}
PlotExp("Zm00001d045479")
```












```{r}
Redox <- read.csv("CSVs/B73-Mo17-BM-ACS26 TMT10 100319_redox.csv", stringsAsFactors = F)
```
```{r}
Redox_PrevSL <- read.csv("CSVs/Seedling-Leaf-Cys-NEM-IAA-TMT6 050219.csv", stringsAsFactors = F)
```

```{r}
colnames(Redox) <- c("nonCys.b73.1", "nonCys.b73.2", "nonCys.b73.3", "nonCys.mo17.1", "nonCys.mo17.2", "nonCys.bm.1", "nonCys.bm.2", "nonCys.acs.1", "nonCys.acs.2", "nonCys.acs.3", "fixedCys.b73.1", "fixedCys.b73.2", "fixedCys.b73.3", "fixedCys.mo17.1", "fixedCys.mo17.2", "fixedCys.bm.1", "fixedCys.bm.2", "fixedCys.acs.1", "fixedCys.acs.2", "fixedCys.acs.3","variableCys.b73.1", "variableCys.b73.2", "variableCys.b73.3", "variableCys.mo17.1", "variableCys.mo17.2", "variableCys.bm.1", "variableCys.bm.2", "variableCys.acs.1", "variableCys.acs.2", "variableCys.acs.3", "Peptide", "Group", "Score", "Accession", "Protein")
```

```{r}
GeomeanSetCols <- function(df, rows){
  x <- NULL
  for(i in 1:nrow(df)){
    v <- as.numeric(df[i, rows])
    gm <- geoMean(v, na.rm = T)
    x[i]<-gm
  }
  x
}
```

```{r}
Redox$nonCys.acs.1.nonCys.b73.1 <- Redox$nonCys.acs.1/Redox$nonCys.b73.1
Redox$nonCys.acs.2.nonCys.b73.2 <- Redox$nonCys.acs.2/Redox$nonCys.b73.2
Redox$nonCys.acs.3.nonCys.b73.3 <- Redox$nonCys.acs.3/Redox$nonCys.b73.3
```
```{r}
Redox$variableCys.acs.1.variableCys.b73.1 <- Redox$variableCys.acs.1/Redox$variableCys.b73.1
Redox$variableCys.acs.2.variableCys.b73.2 <- Redox$variableCys.acs.2/Redox$variableCys.b73.2
Redox$variableCys.acs.3.variableCys.b73.3 <- Redox$variableCys.acs.3/Redox$variableCys.b73.3
```
```{r}
Redox$fixedCys.acs.1.fixedCys.b73.1 <- Redox$fixedCys.acs.1/Redox$fixedCys.b73.1
Redox$fixedCys.acs.2.fixedCys.b73.2 <- Redox$fixedCys.acs.2/Redox$fixedCys.b73.2
Redox$fixedCys.acs.3.fixedCys.b73.3 <- Redox$fixedCys.acs.3/Redox$fixedCys.b73.3
```
```{r}
Redox.WithNons <-Redox[!(Redox$nonCys.b73.1==0),]
```


```{r}
Redox.WithNons$variableCys.acs.1.variableCys.b73.1_nonCys.acs.1.nonCys.b73.1 <- log2(Redox.WithNons$variableCys.acs.1.variableCys.b73.1/Redox.WithNons$nonCys.acs.1.nonCys.b73.1)

Redox.WithNons$variableCys.acs.2.variableCys.b73.2_nonCys.acs.2.nonCys.b73.2 <- log2(Redox.WithNons$variableCys.acs.2.variableCys.b73.2/Redox.WithNons$nonCys.acs.2.nonCys.b73.2)

Redox.WithNons$variableCys.acs.3.variableCys.b73.3_nonCys.acs.3.nonCys.b73.3 <- log2(Redox.WithNons$variableCys.acs.3.variableCys.b73.3/Redox.WithNons$nonCys.acs.3.nonCys.b73.3)


Redox.WithNons$fixedCys.acs.1.fixedCys.b73.1_nonCys.acs.1.nonCys.b73.1 <- log2(Redox.WithNons$fixedCys.acs.1.fixedCys.b73.1/Redox.WithNons$nonCys.acs.1.nonCys.b73.1)

Redox.WithNons$fixedCys.acs.2.fixedCys.b73.2_nonCys.acs.2.nonCys.b73.2 <- log2(Redox.WithNons$fixedCys.acs.2.fixedCys.b73.2/Redox.WithNons$nonCys.acs.2.nonCys.b73.2)

Redox.WithNons$fixedCys.acs.3.fixedCys.b73.3_nonCys.acs.3.nonCys.b73.3 <- log2(Redox.WithNons$fixedCys.acs.3.fixedCys.b73.3/Redox.WithNons$nonCys.acs.3.nonCys.b73.3)
```

```{r}
Redox.WithNons$variableCys.acs.variableCys.b73_nonCys.acs.nonCys.b73.mean <- rowMeans(Redox.WithNons[,45:47])
Redox.WithNons$fixedCys.acs.fixedCys.b73_nonCys.acs.nonCys.b73.mean <- rowMeans(Redox.WithNons[,48:50])
```
```{r}
colMeans(Redox.WithNons[,51:52])
```


```{r}
Redox.WithNons.VarNon <-Redox.WithNons[,c(34,45:47)]
Redox.WithNons.VarNon.m <- melt(Redox.WithNons.VarNon)
```
```{r}
Redox.WithNons.FixNon <-Redox.WithNons[,c(34,48:50)]
Redox.WithNons.FixNon.m <- melt(Redox.WithNons.FixNon)
```
```{r}
Redox.WithNons.VarFixNon.m <- cbind(Redox.WithNons.VarNon.m, Redox.WithNons.FixNon.m[,3])
colnames(Redox.WithNons.VarFixNon.m)  <- c("Accession", "variable", "Var", "Fix")
Redox.WithNons.VarFixNon.m <- Redox.WithNons.VarFixNon.m[(order(Redox.WithNons.VarFixNon.m$Var)),]
Redox.WithNons.VarFixNon.m.m <- melt(Redox.WithNons.VarFixNon.m)
colnames(Redox.WithNons.VarFixNon.m.m) <- c("Accession", "var1", "var2", "value")
Redox.WithNons.VarFixNon.m.m$order <- c((1:((nrow(Redox.WithNons.VarFixNon.m.m))/2)), (1:((nrow(Redox.WithNons.VarFixNon.m.m))/2)))
```

```{r}
Redox.WithNons.NonCys <- Redox.WithNons[,c(34,36:38)]
Redox.WithNons.NonCys.m <- melt(Redox.WithNons.NonCys)

Redox.WithNons.VarCys <- Redox.WithNons[,c(34,39:41)]
Redox.WithNons.VarCys.m <- melt(Redox.WithNons.VarCys)

Redox.WithNons.FixCys <- Redox.WithNons[,c(34,42:44)]
Redox.WithNons.FixCys.m <- melt(Redox.WithNons.FixCys)

Redox.WithNons.NonVarFix <- cbind(Redox.WithNons.NonCys.m, Redox.WithNons.VarCys.m[,3], Redox.WithNons.FixCys.m[,3])
colnames(Redox.WithNons.NonVarFix)  <- c("Accession", "variable","Non", "Var", "Fix")
```

```{r}
library(plotly)
library(htmlwidgets)
```

```{r}
axx <- list(
  nticks = 5,
  range = c(0,3.5)
)

axy <- list(
  nticks = 5,
  range = c(0,3.5)
)

axz <- list(
  nticks = 5,
  range = c(0,3.5)
)


p <- plot_ly(x = ~x, y = ~y, z = ~z, type = 'mesh3d') %>%
  layout(scene = list(xaxis=axx,yaxis=axy,zaxis=axz))
```

```{r}
plot_ly(x=Redox.WithNons.NonVarFix$Non, y=Redox.WithNons.NonVarFix$Var, z=Redox.WithNons.NonVarFix$Fix, type="scatter3d", mode="markers", color=Redox.WithNons.NonVarFix$variable, size = 1, alpha = .5)%>% 
    layout(scene=list(aspectmode='cube', xaxis=axx,yaxis=axy,zaxis=axz))
```

```{r}
ggplot(data=Redox.WithNons.NonVarFix, mapping = aes(x=Non, y = Fix, color=variable))+
  geom_point()+
  xlim(0.5,3)+
  ylim(0.5,3)
```


```{r}
ggplot(data=Redox.WithNons.FixNon.m, mapping = aes(x=value, color=variable))+
  geom_density()+
  theme(legend.position = "bottom")
```
```{r}
Redox_PrevSL.t <- Redox_PrevSL[,c(40,42:59)]
```
```{r}
Redox_PrevSL.t.WithNons<-Redox_PrevSL.t[!(Redox_PrevSL.t$Non.Cys.B73.1==0),]
```
```{r}
colnames(Redox_PrevSL.t.WithNons)
```

```{r}
Redox_PrevSL.t.WithNons$Non.Cys.MP.1 <- rowMeans(Redox_PrevSL.t.WithNons[,c(2,4)])
Redox_PrevSL.t.WithNons$Non.Cys.MP.2 <- rowMeans(Redox_PrevSL.t.WithNons[,c(3,5)])
Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.1 <- rowMeans(Redox_PrevSL.t.WithNons[,c(8,10)])
Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.2 <- rowMeans(Redox_PrevSL.t.WithNons[,c(9,11)])
Redox_PrevSL.t.WithNons$Reduced.Cys.MP.1 <- rowMeans(Redox_PrevSL.t.WithNons[,c(14,16)])
Redox_PrevSL.t.WithNons$Reduced.Cys.MP.2 <- rowMeans(Redox_PrevSL.t.WithNons[,c(15,17)])
```

```{r}
Redox_PrevSL.t.WithNons$Non.Cys.B73.GM <- GeomeanSetCols(Redox_PrevSL.t.WithNons, 2:3)
Redox_PrevSL.t.WithNons$Non.Cys.Mo17.GM <- GeomeanSetCols(Redox_PrevSL.t.WithNons, 4:5)
Redox_PrevSL.t.WithNons$Non.Cys.BM.GM <- GeomeanSetCols(Redox_PrevSL.t.WithNons, 6:7)
Redox_PrevSL.t.WithNons$Non.Cys.MP.GM <- GeomeanSetCols(Redox_PrevSL.t.WithNons, 20:21)
Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.GM <- GeomeanSetCols(Redox_PrevSL.t.WithNons, 8:9)
Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.GM <- GeomeanSetCols(Redox_PrevSL.t.WithNons, 10:11)
Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.GM <- GeomeanSetCols(Redox_PrevSL.t.WithNons, 12:13)
Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.GM <- GeomeanSetCols(Redox_PrevSL.t.WithNons, 22:23)
Redox_PrevSL.t.WithNons$Reduced.Cys.B73.GM <- GeomeanSetCols(Redox_PrevSL.t.WithNons, 14:15)
Redox_PrevSL.t.WithNons$Reduced.Cys.Mo17.GM <- GeomeanSetCols(Redox_PrevSL.t.WithNons, 16:17)
Redox_PrevSL.t.WithNons$Reduced.Cys.BM.GM <- GeomeanSetCols(Redox_PrevSL.t.WithNons, 18:19)
Redox_PrevSL.t.WithNons$Reduced.Cys.MP.GM <- GeomeanSetCols(Redox_PrevSL.t.WithNons, 24:25)
```
```{r}
Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.1.Non.Cys.B73.1 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.1/Redox_PrevSL.t.WithNons$Non.Cys.B73.1
Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.2.Non.Cys.B73.2 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.2/Redox_PrevSL.t.WithNons$Non.Cys.B73.2
Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.GM.Non.Cys.B73.GM <- Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.GM/Redox_PrevSL.t.WithNons$Non.Cys.B73.GM

Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.1.Non.Cys.Mo17.1 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.1/Redox_PrevSL.t.WithNons$Non.Cys.Mo17.1
Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.2.Non.Cys.Mo17.2 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.2/Redox_PrevSL.t.WithNons$Non.Cys.Mo17.2
Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.GM.Non.Cys.Mo17.GM <- Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.GM/Redox_PrevSL.t.WithNons$Non.Cys.Mo17.GM

Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.1.Non.Cys.BM.1 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.1/Redox_PrevSL.t.WithNons$Non.Cys.BM.1
Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.2.Non.Cys.BM.2 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.2/Redox_PrevSL.t.WithNons$Non.Cys.BM.2
Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.GM.Non.Cys.BM.GM <- Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.GM/Redox_PrevSL.t.WithNons$Non.Cys.BM.GM

Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.1.Non.Cys.MP.1 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.1/Redox_PrevSL.t.WithNons$Non.Cys.MP.1
Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.2.Non.Cys.MP.2 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.2/Redox_PrevSL.t.WithNons$Non.Cys.MP.2
Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.GM.Non.Cys.MP.GM <- Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.GM/Redox_PrevSL.t.WithNons$Non.Cys.MP.GM
```
```{r}
Redox_PrevSL.t.WithNons$Reduced.Cys.B73.1.Non.Cys.B73.1 <- Redox_PrevSL.t.WithNons$Reduced.Cys.B73.1/Redox_PrevSL.t.WithNons$Non.Cys.B73.1
Redox_PrevSL.t.WithNons$Reduced.Cys.B73.2.Non.Cys.B73.2 <- Redox_PrevSL.t.WithNons$Reduced.Cys.B73.2/Redox_PrevSL.t.WithNons$Non.Cys.B73.2
Redox_PrevSL.t.WithNons$Reduced.Cys.B73.GM.Non.Cys.B73.GM <- Redox_PrevSL.t.WithNons$Reduced.Cys.B73.GM/Redox_PrevSL.t.WithNons$Non.Cys.B73.GM

Redox_PrevSL.t.WithNons$Reduced.Cys.Mo17.1.Non.Cys.Mo17.1 <- Redox_PrevSL.t.WithNons$Reduced.Cys.Mo17.1/Redox_PrevSL.t.WithNons$Non.Cys.Mo17.1
Redox_PrevSL.t.WithNons$Reduced.Cys.Mo17.2.Non.Cys.Mo17.2 <- Redox_PrevSL.t.WithNons$Reduced.Cys.Mo17.2/Redox_PrevSL.t.WithNons$Non.Cys.Mo17.2
Redox_PrevSL.t.WithNons$Reduced.Cys.Mo17.GM.Non.Cys.Mo17.GM <- Redox_PrevSL.t.WithNons$Reduced.Cys.Mo17.GM/Redox_PrevSL.t.WithNons$Non.Cys.Mo17.GM

Redox_PrevSL.t.WithNons$Reduced.Cys.BM.1.Non.Cys.BM.1 <- Redox_PrevSL.t.WithNons$Reduced.Cys.BM.1/Redox_PrevSL.t.WithNons$Non.Cys.BM.1
Redox_PrevSL.t.WithNons$Reduced.Cys.BM.2.Non.Cys.BM.2 <- Redox_PrevSL.t.WithNons$Reduced.Cys.BM.2/Redox_PrevSL.t.WithNons$Non.Cys.BM.2
Redox_PrevSL.t.WithNons$Reduced.Cys.BM.GM.Non.Cys.BM.GM <- Redox_PrevSL.t.WithNons$Reduced.Cys.BM.GM/Redox_PrevSL.t.WithNons$Non.Cys.BM.GM

Redox_PrevSL.t.WithNons$Reduced.Cys.MP.1.Non.Cys.MP.1 <- Redox_PrevSL.t.WithNons$Reduced.Cys.MP.1/Redox_PrevSL.t.WithNons$Non.Cys.MP.1
Redox_PrevSL.t.WithNons$Reduced.Cys.MP.2.Non.Cys.MP.2 <- Redox_PrevSL.t.WithNons$Reduced.Cys.MP.2/Redox_PrevSL.t.WithNons$Non.Cys.MP.2
Redox_PrevSL.t.WithNons$Reduced.Cys.MP.GM.Non.Cys.MP.GM <- Redox_PrevSL.t.WithNons$Reduced.Cys.MP.GM/Redox_PrevSL.t.WithNons$Non.Cys.MP.GM
```
```{r}
Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.1.Reduced.Cys.B73.1 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.1/Redox_PrevSL.t.WithNons$Reduced.Cys.B73.1
Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.2.Reduced.Cys.B73.2 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.2/Redox_PrevSL.t.WithNons$Reduced.Cys.B73.2
Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.GM.Reduced.Cys.B73.GM <- Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.GM/Redox_PrevSL.t.WithNons$Reduced.Cys.B73.GM

Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.1.Reduced.Cys.Mo17.1 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.1/Redox_PrevSL.t.WithNons$Reduced.Cys.Mo17.1
Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.2.Reduced.Cys.Mo17.2 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.2/Redox_PrevSL.t.WithNons$Reduced.Cys.Mo17.2
Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.GM.Reduced.Cys.Mo17.GM <- Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.GM/Redox_PrevSL.t.WithNons$Reduced.Cys.Mo17.GM

Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.1.Reduced.Cys.BM.1 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.1/Redox_PrevSL.t.WithNons$Reduced.Cys.BM.1
Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.2.Reduced.Cys.BM.2 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.2/Redox_PrevSL.t.WithNons$Reduced.Cys.BM.2
Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.GM.Reduced.Cys.BM.GM <- Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.GM/Redox_PrevSL.t.WithNons$Reduced.Cys.BM.GM

Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.1.Reduced.Cys.MP.1 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.1/Redox_PrevSL.t.WithNons$Reduced.Cys.MP.1
Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.2.Reduced.Cys.MP.2 <- Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.2/Redox_PrevSL.t.WithNons$Reduced.Cys.MP.2
Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.GM.Reduced.Cys.MP.GM <- Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.GM/Redox_PrevSL.t.WithNons$Reduced.Cys.MP.GM
```
```{r}
mean(Redox_PrevSL.t.WithNons$Non.Cys.B73.GM)
mean(Redox_PrevSL.t.WithNons$Non.Cys.Mo17.GM)
mean(Redox_PrevSL.t.WithNons$Non.Cys.BM.GM)
mean(Redox_PrevSL.t.WithNons$Non.Cys.MP.GM)
```
```{r}
mean(Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.GM)
mean(Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.GM)
mean(Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.GM)
mean(Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.GM)
```
```{r}
mean(Redox_PrevSL.t.WithNons$Reduced.Cys.B73.GM)
mean(Redox_PrevSL.t.WithNons$Reduced.Cys.Mo17.GM)
mean(Redox_PrevSL.t.WithNons$Reduced.Cys.BM.GM)
mean(Redox_PrevSL.t.WithNons$Reduced.Cys.MP.GM)
```
```{r}
mean(Redox_PrevSL.t.WithNons$Oxidized.Cys.B73.GM.Non.Cys.B73.GM)
mean(Redox_PrevSL.t.WithNons$Oxidized.Cys.Mo17.GM.Non.Cys.Mo17.GM)
mean(Redox_PrevSL.t.WithNons$Oxidized.Cys.BM.GM.Non.Cys.BM.GM)
mean(Redox_PrevSL.t.WithNons$Oxidized.Cys.MP.GM.Non.Cys.MP.GM)
```

```{r}
colnames(Redox_PrevSL.t.WithNons)
```

```{r}
Redox_PrevSL.t.WithNons.Ox.Non.B73 <- Redox_PrevSL.t.WithNons[,c(1,38:40)]
Redox_PrevSL.t.WithNons.Ox.Non.Mo17 <- Redox_PrevSL.t.WithNons[,c(1,41:43)]
Redox_PrevSL.t.WithNons.Ox.Non.BM <- Redox_PrevSL.t.WithNons[,c(1,44:46)]
Redox_PrevSL.t.WithNons.Ox.Non.MP <- Redox_PrevSL.t.WithNons[,c(1,47:49)]

Redox_PrevSL.t.WithNons.Red.Non.B73 <- Redox_PrevSL.t.WithNons[,c(1,50:52)]
Redox_PrevSL.t.WithNons.Red.Non.Mo17 <- Redox_PrevSL.t.WithNons[,c(1,53:55)]
Redox_PrevSL.t.WithNons.Red.Non.BM <- Redox_PrevSL.t.WithNons[,c(1,56:58)]
Redox_PrevSL.t.WithNons.Red.Non.MP <- Redox_PrevSL.t.WithNons[,c(1,59:61)]

Redox_PrevSL.t.WithNons.Ox.Red.B73 <- Redox_PrevSL.t.WithNons[,c(1,62:64)]
Redox_PrevSL.t.WithNons.Ox.Red.Mo17 <- Redox_PrevSL.t.WithNons[,c(1,65:67)]
Redox_PrevSL.t.WithNons.Ox.Red.BM <- Redox_PrevSL.t.WithNons[,c(1,68:70)]
Redox_PrevSL.t.WithNons.Ox.Red.MP <- Redox_PrevSL.t.WithNons[,c(1,71:73)]
```

```{r}
Redox_PrevSL.t.WithNons.Ox.Non.B73.m <- melt(Redox_PrevSL.t.WithNons.Ox.Non.B73)
Redox_PrevSL.t.WithNons.Ox.Non.Mo17.m <- melt(Redox_PrevSL.t.WithNons.Ox.Non.Mo17)
Redox_PrevSL.t.WithNons.Ox.Non.BM.m <- melt(Redox_PrevSL.t.WithNons.Ox.Non.BM)
Redox_PrevSL.t.WithNons.Ox.Non.MP.m <- melt(Redox_PrevSL.t.WithNons.Ox.Non.MP)

Redox_PrevSL.t.WithNons.Red.Non.B73.m <- melt(Redox_PrevSL.t.WithNons.Red.Non.B73)
Redox_PrevSL.t.WithNons.Red.Non.Mo17.m <- melt(Redox_PrevSL.t.WithNons.Red.Non.Mo17)
Redox_PrevSL.t.WithNons.Red.Non.BM.m <- melt(Redox_PrevSL.t.WithNons.Red.Non.BM)
Redox_PrevSL.t.WithNons.Red.Non.MP.m <- melt(Redox_PrevSL.t.WithNons.Red.Non.MP)

Redox_PrevSL.t.WithNons.Ox.Red.B73.m <- melt(Redox_PrevSL.t.WithNons.Ox.Red.B73)
Redox_PrevSL.t.WithNons.Ox.Red.Mo17.m <- melt(Redox_PrevSL.t.WithNons.Ox.Red.Mo17)
Redox_PrevSL.t.WithNons.Ox.Red.BM.m <- melt(Redox_PrevSL.t.WithNons.Ox.Red.BM)
Redox_PrevSL.t.WithNons.Ox.Red.MP.m <- melt(Redox_PrevSL.t.WithNons.Ox.Red.MP)
```
```{r}
Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m <- cbind(Redox_PrevSL.t.WithNons.Ox.Non.B73.m, Redox_PrevSL.t.WithNons.Ox.Non.Mo17.m[,3], Redox_PrevSL.t.WithNons.Ox.Non.BM.m[,3], Redox_PrevSL.t.WithNons.Ox.Non.MP.m[,3])
Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m <- cbind(Redox_PrevSL.t.WithNons.Red.Non.B73.m, Redox_PrevSL.t.WithNons.Red.Non.Mo17.m[,3], Redox_PrevSL.t.WithNons.Red.Non.BM.m[,3], Redox_PrevSL.t.WithNons.Red.Non.MP.m[,3])
Redox_PrevSL.t.WithNons.Ox.Red.B73.Mo17.m <- cbind(Redox_PrevSL.t.WithNons.Ox.Red.B73.m, Redox_PrevSL.t.WithNons.Ox.Red.Mo17.m[,3], Redox_PrevSL.t.WithNons.Ox.Red.BM.m[,3], Redox_PrevSL.t.WithNons.Ox.Red.MP.m[,3])
colnames(Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m) <- c("Accession", "ratio", "B73", "Mo17", "BM", "MP")
colnames(Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m) <- c("Accession", "ratio", "B73", "Mo17", "BM", "MP")
colnames(Redox_PrevSL.t.WithNons.Ox.Red.B73.Mo17.m) <- c("Accession", "ratio", "B73", "Mo17", "BM", "MP")
```

```{r}
Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m$ratio<- c(rep("rep1", 790), rep("rep2", 790), rep("GM", 790))
Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m$ratio<- c(rep("rep1", 790), rep("rep2", 790), rep("GM", 790))
Redox_PrevSL.t.WithNons.Ox.Red.B73.Mo17.m$ratio<- c(rep("rep1", 790), rep("rep2", 790), rep("GM", 790))
```
```{r}
dir.create("Redox_PrevSL.t.WithNons.Plots")
```

```{r}
ggplot(data=Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m[-(grep("GM",Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m$ratio)),], mapping = aes(x=(MP), y = (BM), color=ratio))+
  geom_point(size=.8)+
  geom_smooth(method = "lm", se = FALSE, size=.4)+
  theme_bw()+
  theme(legend.position = "bottom")+
  theme(plot.margin=grid::unit(c(0,0,0,0), "mm"), legend.position = "bottom")+
  xlab("Mid-parent oxidized/non")+
  ylab("BxM oxidized/non")+
  geom_abline(slope = 1, color="grey", size=.5)+
  xlim(0,70)+
  ylim(0,70)+
  coord_fixed(expand = F)
ggsave("Redox_PrevSL.t.WithNons.Plots/Ox.Non.MP.BM.png", width = 4.5)
```


```{r}
Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m.GM <- Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m[(grep("GM",Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m$ratio)),]
Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m.GM.m <- melt(Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m.GM)
```
```{r}
Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m.GM <- Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m[(grep("GM",Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m$ratio)),]
Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m.GM.m <- melt(Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m.GM)
```

```{r}
ggplot(data=Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m.GM.m[grep("BM|MP",Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m.GM.m$variable),], mapping = aes(x=log2(value), fill=variable))+
  geom_density(alpha=0.4)+
xlab("log2(reduced/non)")
ggsave("Redox_PrevSL.t.WithNons.Red.Non.BM.MP.density.png", width = 8, height = 2)
```
```{r}
ggplot(data=Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m.GM.m[-grep("BM|MP",Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m.GM.m$variable),], mapping = aes(x=log2(value), fill=variable))+
  geom_density(alpha=0.4)+
xlab("log2(reduced/non)")
ggsave("Redox_PrevSL.t.WithNons.Red.Non.b73.mo17.density.png", width = 8, height = 2)
```
```{r}
ggplot(data=Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m.GM.m[grep("BM|MP",Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m.GM.m$variable),], mapping = aes(x=log2(value), fill=variable))+
  geom_density(alpha=0.4)+
  xlab("log2(oxidized/non)")
ggsave("Redox_PrevSL.t.WithNons.Ox.Non.BM.MP.density.png", width = 8, height = 2)
```
```{r}
ggplot(data=Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m.GM.m[-grep("BM|MP",Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m.GM.m$variable),], mapping = aes(x=log2(value), fill=variable))+
  geom_density(alpha=0.4)+
  xlab("log2(oxidized/non)")
ggsave("Redox_PrevSL.t.WithNons.Ox.Non.b73.mo17.density.png", width = 8, height = 2)
```

```{r}
ggplot(data=Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m[-(grep("GM",Redox_PrevSL.t.WithNons.Ox.Non.B73.Mo17.m$ratio)),], mapping = aes(x=B73, y = Mo17, color=ratio))+
  geom_point(size=.8)+
  geom_smooth(method = "lm", se = FALSE, size=.4)+
  theme_bw()+
  theme(plot.margin=grid::unit(c(0,0,0,0), "mm"), legend.position = "bottom")+
  ylab("Mo17 oxidized/non")+
  xlab("B73 oxidized/non")+
  geom_abline(slope = 1, color="grey", size=.5)+
  xlim(0,65)+
  ylim(0,65)+
  coord_fixed(expand = F)
ggsave("Redox_PrevSL.t.WithNons.Plots/Ox.Non.B73.Mo17.png", width = 4.5)
```
```{r}
ggplot(data=Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m[-(grep("GM",Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m$ratio)),], mapping = aes(x=(MP), y=(BM), color=ratio))+
  geom_point(size=.8)+
  geom_smooth(method = "lm", se = FALSE, size=.4)+
  theme_bw()+
  theme(legend.position = "bottom")+
  theme(plot.margin=grid::unit(c(0,0,0,0), "mm"), legend.position = "bottom")+
  xlab("Mid-parent reduced/non")+
  ylab("BxM reduced/non")+
  geom_abline(slope = 1, color="grey", size=.5)+
  xlim(0,150)+
  ylim(0,150)+
  coord_fixed(expand = F)
ggsave("Redox_PrevSL.t.WithNons.Plots/Red.Non.BM.MP.png", width = 4.5)
```
```{r}
ggplot(data=Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m[-(grep("GM",Redox_PrevSL.t.WithNons.Red.Non.B73.Mo17.m$ratio)),], mapping = aes(x=B73, y = Mo17, color=ratio))+
  geom_point(size=.8)+
  geom_smooth(method = "lm", se = FALSE,size=.4)+
  theme_bw()+
  theme(plot.margin=grid::unit(c(0,0,0,0), "mm"), legend.position = "bottom")+
  ylab("Mo17 reduced/non)")+
  xlab("B73 reduced/non")+
  geom_abline(slope = 1, color="black", alpha=0.4, size=.5)+
  xlim(0,180)+
  ylim(0,180)+
  coord_fixed(expand = F)
ggsave("Redox_PrevSL.t.WithNons.Plots/Red.Non.B73.Mo17.png", width = 4.5)
```
```{r}
ggplot(data=Redox_PrevSL.t.WithNons.Ox.Red.B73.Mo17.m[-(grep("GM",Redox_PrevSL.t.WithNons.Ox.Red.B73.Mo17.m$ratio)),], mapping = aes(x=B73, y = Mo17, color=ratio))+
  geom_point(size=.8)+
  geom_smooth(method = "lm", se = FALSE, size=.4)+
  theme_bw()+
  theme(plot.margin=grid::unit(c(0,0,0,0), "mm"), legend.position = "bottom")+
  ylab("Mo17 oxidized/red")+
  xlab("B73 oxidized/red")+
  geom_abline(slope = 1, color="black", alpha=0.4, size=.5)+
  xlim(0,4500)+
  ylim(0,4500)+
  coord_fixed(expand = F)
ggsave("Redox_PrevSL.t.WithNons.Plots/Ox.Red.B73.Mo17.png", width = 4.5)
```

```{r}
ggplot(data=Redox_PrevSL.t.WithNons.Ox.Red.B73.Mo17.m[-(grep("GM",Redox_PrevSL.t.WithNons.Ox.Red.B73.Mo17.m$ratio)),], mapping = aes(x=(MP), y = (BM), color=ratio))+
  geom_point(size=.8)+
  geom_smooth(method = "lm", se = FALSE, size=.4)+
  theme_bw()+ 
  theme(plot.margin=grid::unit(c(0,0,0,0), "mm"), legend.position = "bottom")+
  xlab("Mid-Parent oxidized/red")+
  ylab("BxM oxidized/red")+
  geom_abline(slope = 1, color="grey", size=.5)+
  xlim(0,5000)+
  ylim(0,5000)+
  coord_fixed(expand = F)
ggsave("Redox_PrevSL.t.WithNons.Plots/Ox.Red.MP.BM.png", width = 4.5)
```

```{r}
Redox_PrevSL.t.WithNons2<-Redox_PrevSL.t[!(Redox_PrevSL.t$Non.Cys.B73.1==0),]
```
```{r}
colnames(Redox_PrevSL.t.WithNons2)
```

```{r}
Redox_PrevSL.t.WithNons2$Non.Cys.MP.1 <- rowMeans(Redox_PrevSL.t.WithNons2[,c(2,4)])
Redox_PrevSL.t.WithNons2$Non.Cys.MP.2 <- rowMeans(Redox_PrevSL.t.WithNons2[,c(3,5)])
Redox_PrevSL.t.WithNons2$Oxidized.Cys.MP.1 <- rowMeans(Redox_PrevSL.t.WithNons2[,c(8,10)])
Redox_PrevSL.t.WithNons2$Oxidized.Cys.MP.2 <- rowMeans(Redox_PrevSL.t.WithNons2[,c(9,11)])
Redox_PrevSL.t.WithNons2$Reduced.Cys.MP.1 <- rowMeans(Redox_PrevSL.t.WithNons2[,c(14,16)])
Redox_PrevSL.t.WithNons2$Reduced.Cys.MP.2 <- rowMeans(Redox_PrevSL.t.WithNons2[,c(15,17)])
```


```{r}
Redox_PrevSL.t.WithNons2$l2.Non.Cys.B73.1.Non.Cys.Mo17.1 <- log2(Redox_PrevSL.t.WithNons2$Non.Cys.B73.1/Redox_PrevSL.t.WithNons2$Non.Cys.Mo17.1)
Redox_PrevSL.t.WithNons2$l2.Non.Cys.B73.2.Non.Cys.Mo17.2 <- log2(Redox_PrevSL.t.WithNons2$Non.Cys.B73.2/Redox_PrevSL.t.WithNons2$Non.Cys.Mo17.2)

Redox_PrevSL.t.WithNons2$l2.Oxidized.Cys.B73.1.Oxidized.Cys.Mo17.1 <- log2(Redox_PrevSL.t.WithNons2$Oxidized.Cys.B73.1/Redox_PrevSL.t.WithNons2$Oxidized.Cys.Mo17.1)
Redox_PrevSL.t.WithNons2$l2.Oxidized.Cys.B73.2.Oxidized.Cys.Mo17.2 <- log2(Redox_PrevSL.t.WithNons2$Oxidized.Cys.B73.2/Redox_PrevSL.t.WithNons2$Oxidized.Cys.Mo17.2)

Redox_PrevSL.t.WithNons2$l2.Reduced.Cys.B73.1.Reduced.Cys.Mo17.1 <- log2(Redox_PrevSL.t.WithNons2$Reduced.Cys.B73.1/Redox_PrevSL.t.WithNons2$Reduced.Cys.Mo17.1)
Redox_PrevSL.t.WithNons2$l2.Reduced.Cys.B73.2.Reduced.Cys.Mo17.2 <- log2(Redox_PrevSL.t.WithNons2$Reduced.Cys.B73.2/Redox_PrevSL.t.WithNons2$Reduced.Cys.Mo17.2)
```
```{r}
Redox_PrevSL.t.WithNons2$l2.Non.Cys.BM.1.Non.Cys.MP.1 <- log2(Redox_PrevSL.t.WithNons2$Non.Cys.BM.1/Redox_PrevSL.t.WithNons2$Non.Cys.MP.1)
Redox_PrevSL.t.WithNons2$l2.Non.Cys.BM.2.Non.Cys.MP.2 <- log2(Redox_PrevSL.t.WithNons2$Non.Cys.BM.2/Redox_PrevSL.t.WithNons2$Non.Cys.MP.2)

Redox_PrevSL.t.WithNons2$l2.Oxidized.Cys.BM.1.Oxidized.Cys.MP.1 <- log2(Redox_PrevSL.t.WithNons2$Oxidized.Cys.BM.1/Redox_PrevSL.t.WithNons2$Oxidized.Cys.MP.1)
Redox_PrevSL.t.WithNons2$l2.Oxidized.Cys.BM.2.Oxidized.Cys.MP.2 <- log2(Redox_PrevSL.t.WithNons2$Oxidized.Cys.BM.2/Redox_PrevSL.t.WithNons2$Oxidized.Cys.MP.2)

Redox_PrevSL.t.WithNons2$l2.Reduced.Cys.BM.1.Reduced.Cys.MP.1 <- log2(Redox_PrevSL.t.WithNons2$Reduced.Cys.BM.1/Redox_PrevSL.t.WithNons2$Reduced.Cys.MP.1)
Redox_PrevSL.t.WithNons2$l2.Reduced.Cys.BM.2.Reduced.Cys.MP.2 <- log2(Redox_PrevSL.t.WithNons2$Reduced.Cys.BM.2/Redox_PrevSL.t.WithNons2$Reduced.Cys.MP.2)
```
```{r}
colnames(Redox_PrevSL.t.WithNons2)
```

```{r}
Redox_PrevSL.t.WithNons2.m <- cbind(melt(Redox_PrevSL.t.WithNons2[,c(1,26,27)]), (melt(Redox_PrevSL.t.WithNons2[,c(1,28,29)]))[,3], (melt(Redox_PrevSL.t.WithNons2[,c(1,30,31)]))[,3], (melt(Redox_PrevSL.t.WithNons2[,c(1,32,33)]))[,3], (melt(Redox_PrevSL.t.WithNons2[,c(1,34,35)]))[,3], (melt(Redox_PrevSL.t.WithNons2[,c(1,36,37)]))[,3])
```

```{r}
colnames(Redox_PrevSL.t.WithNons2.m) <- c("Accession","ratio", "log2(B73non/Mo17non)", "log2(B73ox/Mo17ox)", "log2(B73red/Mo17red)", "log2(BMnon/MPnon)", "log2(BMox/MPox)", "log2(BMred/MPred)")
```
```{r}
Redox_PrevSL.t.WithNons2.m$ratio <- c(rep("B73.1/Mo17.1", 790), rep("B73.2/Mo17.2", 790))
```

```{r}
Plot_Redox_PrevSL.t.WithNons2.m <- function(X,Y){
  dir.create("Plot_Redox_PrevSL.t.WithNons2.m")
  setwd("Plot_Redox_PrevSL.t.WithNons2.m")
  nameX <- deparse(substitute(X))
  nameY <- deparse(substitute(Y))
  nameX2 <- substr(nameX, start = 29, stop=((nchar(nameX))-1))
  nameY2 <- substr(nameY, start = 29, stop=((nchar(nameY))-1))
  nameX3 <- str_replace_all(nameX2, "[:punct:]", "_")
  nameY3 <- str_replace_all(nameY2, "[:punct:]", "_")
ggplot(data=Redox_PrevSL.t.WithNons2.m, mapping = aes(x=X, y = Y, color=ratio))+
  geom_point(size=.75, alpha=0.4)+
  theme_light()+
  xlab(nameX2)+
  ylab(nameY2)+
  scale_x_continuous(limits=c(min(X,Y), max(X,Y))) +
  scale_y_continuous(limits=c(min(X,Y), max(X,Y))) +
  theme(aspect.ratio=1)+
  theme(plot.margin=grid::unit(c(0,0,0,0), "mm"))+
  theme(legend.position = "bottom")+
  geom_abline(slope = 0, color="darkgrey", size=.5)+
  geom_abline(slope = 1, color="grey50", size=.5, linetype="dashed")+
  geom_vline(xintercept = 0, color="darkgrey", size=.5)
ggsave(paste0(nameX3, ".", nameY3, ".png"))
}
```
```{r}
Plot_Redox_PrevSL.t.WithNons2.m(Redox_PrevSL.t.WithNons2.m$`log2(BMox/MPox)`, Redox_PrevSL.t.WithNons2.m$`log2(BMred/MPred)`)
```



```{r}
Redox.WithNons2<-Redox[!(Redox$nonCys.b73.1==0),]
```

```{r}
Redox.WithNons2$nonCys.b73.GM <- GeomeanSetCols(Redox.WithNons2, 1:3)
Redox.WithNons2$nonCys.acs.GM <- GeomeanSetCols(Redox.WithNons2, 8:10)
Redox.WithNons2$fixedCys.b73.GM <- GeomeanSetCols(Redox.WithNons2, 11:13)
Redox.WithNons2$fixedCys.acs.GM <- GeomeanSetCols(Redox.WithNons2, 18:20)
Redox.WithNons2$variableCys.b73.GM <- GeomeanSetCols(Redox.WithNons2, 21:23)
Redox.WithNons2$variableCys.acs.GM <- GeomeanSetCols(Redox.WithNons2, 28:30)
```

```{r}
Redox.WithNons2$fixedCys.acs.1_nonCys.acs.1 <- Redox.WithNons2$fixedCys.acs.1/Redox.WithNons2$nonCys.acs.1
Redox.WithNons2$fixedCys.acs.2_nonCys.acs.2 <- Redox.WithNons2$fixedCys.acs.2/Redox.WithNons2$nonCys.acs.2
Redox.WithNons2$fixedCys.acs.3_nonCys.acs.3 <- Redox.WithNons2$fixedCys.acs.3/Redox.WithNons2$nonCys.acs.3
Redox.WithNons2$fixedCys.acs.GM_nonCys.acs.GM <- Redox.WithNons2$fixedCys.acs.GM/Redox.WithNons2$nonCys.acs.GM

Redox.WithNons2$fixedCys.b73.1_nonCys.b73.1 <- Redox.WithNons2$fixedCys.b73.1/Redox.WithNons2$nonCys.b73.1
Redox.WithNons2$fixedCys.b73.2_nonCys.b73.2 <- Redox.WithNons2$fixedCys.b73.2/Redox.WithNons2$nonCys.b73.2
Redox.WithNons2$fixedCys.b73.3_nonCys.b73.3 <- Redox.WithNons2$fixedCys.b73.3/Redox.WithNons2$nonCys.b73.3
Redox.WithNons2$fixedCys.b73.GM_nonCys.b73.GM <- Redox.WithNons2$fixedCys.b73.GM/Redox.WithNons2$nonCys.b73.GM
```
```{r}
Redox.WithNons2$variableCys.acs.1_nonCys.acs.1 <- Redox.WithNons2$variableCys.acs.1/Redox.WithNons2$nonCys.acs.1
Redox.WithNons2$variableCys.acs.2_nonCys.acs.2 <- Redox.WithNons2$variableCys.acs.2/Redox.WithNons2$nonCys.acs.2
Redox.WithNons2$variableCys.acs.3_nonCys.acs.3 <- Redox.WithNons2$variableCys.acs.3/Redox.WithNons2$nonCys.acs.3
Redox.WithNons2$variableCys.acs.GM_nonCys.acs.GM <- Redox.WithNons2$variableCys.acs.GM/Redox.WithNons2$nonCys.acs.GM

Redox.WithNons2$variableCys.b73.1_nonCys.b73.1 <- Redox.WithNons2$variableCys.b73.1/Redox.WithNons2$nonCys.b73.1
Redox.WithNons2$variableCys.b73.2_nonCys.b73.2 <- Redox.WithNons2$variableCys.b73.2/Redox.WithNons2$nonCys.b73.2
Redox.WithNons2$variableCys.b73.3_nonCys.b73.3 <- Redox.WithNons2$variableCys.b73.3/Redox.WithNons2$nonCys.b73.3
Redox.WithNons2$variableCys.b73.GM_nonCys.b73.GM <- Redox.WithNons2$variableCys.b73.GM/Redox.WithNons2$nonCys.b73.GM
```
```{r}
Redox.WithNons2$fixedCys.acs.1_variableCys.acs.1 <- Redox.WithNons2$fixedCys.acs.1/Redox.WithNons2$variableCys.acs.1
Redox.WithNons2$fixedCys.acs.2_variableCys.acs.2 <- Redox.WithNons2$fixedCys.acs.2/Redox.WithNons2$variableCys.acs.2
Redox.WithNons2$fixedCys.acs.3_variableCys.acs.3 <- Redox.WithNons2$fixedCys.acs.3/Redox.WithNons2$variableCys.acs.3
Redox.WithNons2$fixedCys.acs.GM_variableCys.acs.GM <- Redox.WithNons2$fixedCys.acs.GM/Redox.WithNons2$variableCys.acs.GM

Redox.WithNons2$fixedCys.b73.1_variableCys.b73.1 <- Redox.WithNons2$fixedCys.b73.1/Redox.WithNons2$variableCys.b73.1
Redox.WithNons2$fixedCys.b73.2_variableCys.b73.2 <- Redox.WithNons2$fixedCys.b73.2/Redox.WithNons2$variableCys.b73.2
Redox.WithNons2$fixedCys.b73.3_variableCys.b73.3 <- Redox.WithNons2$fixedCys.b73.3/Redox.WithNons2$variableCys.b73.3
Redox.WithNons2$fixedCys.b73.GM_variableCys.b73.GM <- Redox.WithNons2$fixedCys.b73.GM/Redox.WithNons2$variableCys.b73.GM
```
```{r}
colnames(Redox.WithNons2)
```

```{r}
#change cols
Redox.WithNons2.fixed.acs <- Redox.WithNons2[,c(34,51:54)]
Redox.WithNons2.fixed.b73 <- Redox.WithNons2[,c(34,55:58)]
Redox.WithNons2.variable.acs <- Redox.WithNons2[,c(34,59:62)]
Redox.WithNons2.variable.b73 <- Redox.WithNons2[,c(34,63:66)]
Redox.WithNons2.fix.var.acs <- Redox.WithNons2[,c(34,67:70)]
Redox.WithNons2.fix.var.b73 <- Redox.WithNons2[,c(34,71:74)]
```

```{r}
Redox.WithNons2.fixed.acs.m <- melt(Redox.WithNons2.fixed.acs)
Redox.WithNons2.fixed.b73.m <- melt(Redox.WithNons2.fixed.b73)
Redox.WithNons2.variable.acs.m <- melt(Redox.WithNons2.variable.acs)
Redox.WithNons2.variable.b73.m <- melt(Redox.WithNons2.variable.b73)
Redox.WithNons2.fix.var.acs.m <- melt(Redox.WithNons2.fix.var.acs)
Redox.WithNons2.fix.var.b73.m <- melt(Redox.WithNons2.fix.var.b73)
```

```{r}
Redox.WithNons2.fixed.m <- cbind(Redox.WithNons2.fixed.acs.m, Redox.WithNons2.fixed.b73.m[,3])
Redox.WithNons2.variable.m <- cbind(Redox.WithNons2.variable.acs.m, Redox.WithNons2.variable.b73.m[,3])
Redox.WithNons2.fix.var.m <- cbind(Redox.WithNons2.fix.var.acs.m, Redox.WithNons2.fix.var.b73.m[,3])

colnames(Redox.WithNons2.fixed.m) <- c("Accession", "ratio", "acs", "B73")
colnames(Redox.WithNons2.variable.m) <- c("Accession", "ratio", "acs", "B73")
colnames(Redox.WithNons2.fix.var.m) <- c("Accession", "ratio", "acs", "B73")
```

```{r}
Redox.WithNons2.fixed.m.GM <- Redox.WithNons2.fixed.m[(grep("GM",Redox.WithNons2.fixed.m$ratio)),]
Redox.WithNons2.fixed.m.GM.m <- melt(Redox.WithNons2.fixed.m.GM)
```
```{r}
Redox.WithNons2.variable.m.GM <- Redox.WithNons2.variable.m[(grep("GM",Redox.WithNons2.variable.m$ratio)),]
Redox.WithNons2.variable.m.m <- melt(Redox.WithNons2.variable.m)
```
```{r}
ggplot(data=Redox.WithNons2.fixed.m.GM.m, mapping = aes(x=log2(value), fill=variable))+
  geom_density(alpha=0.4)+
  xlab("log2(oxidized/non)")
ggsave("Redox.WithNons.OX.Non.acs.b73.density.png", width = 8, height = 2)
```
```{r}
ggplot(data=Redox.WithNons2.variable.m.m, mapping = aes(x=log2(value), fill=variable))+
  geom_density(alpha=0.4)
xlab("log2(reduced/non)")
ggsave("Redox.WithNons.Red.Non.acs.b73.density.png", width = 8, height = 2)
```
```{r}
ggplot(data=Redox.WithNons2.fix.var.m[-grep("GM", Redox.WithNons2.fix.var.m$ratio),], mapping = aes(x=B73, y = acs, color=ratio))+
  geom_point(size=.7)+
  geom_smooth(method = "lm", se = FALSE, linetype="dashed", size=.5)+
  theme_bw()+
 # theme(legend.position = "none")+
  ylab("acs2/6 oxidized/reduced")+
  xlab("B73 oxidized/reduced")+
  geom_abline(xintercept = 0, slope = 1, color="grey", size=.5)+
  coord_fixed(expand = F)+
  xlim(0,270)+
  ylim(0,270)
ggsave("fix.var_B73.acs.png")
```
```{r}
ggplot(data=Redox.WithNons2.variable.m[-grep("GM", Redox.WithNons2.variable.m$ratio),], mapping = aes(x=B73, y = acs, color=ratio))+
  geom_point(size=.7)+
  geom_smooth(method = "lm", se = FALSE, linetype="dashed", size=.5)+
  theme_bw()+
#  theme(legend.position = "none")+
  ylab("acs2/6 reduced/non")+
  xlab("B73 reduced/non")+
  geom_abline(xintercept = 0, slope = 1, color="grey", size=.5)+
  xlim(0,11)+
  ylim(0,11)+
  coord_fixed()
ggsave("Var.Non_B73.acs.png")
```
```{r}
ggplot(data=Redox.WithNons2.fixed.m[-grep("GM", Redox.WithNons2.fixed.m$ratio),], mapping = aes(x=B73, y = acs, color=ratio))+
  geom_point(size=.7)+
  geom_smooth(method = "lm", se = FALSE, linetype="dashed", size=.5)+
  theme_bw()+
#  theme(legend.position = "none")+
  ylab("acs2/6 oxidized/non")+
  xlab("B73 oxidized/non")+
  xlim(0,7)+
  ylim(0,7)+
  geom_abline(xintercept = 0, slope = 1, color="grey", size=.5)+
  coord_fixed()
#ggsave("Fix.Non_B73.acs.png")
```



# Plastid-encoded proteins
```{r}
PE <- read.csv("ACS_Plastid.csv", stringsAsFactors = F)
```
```{r}
colnames(PE)
```

```{r}
avgCV<-function(x){
  B73CV<-(sd(x[1:3])/mean(x[1:3]))*100
  Mo17CV<-(sd(x[4:5])/mean(x[4:5]))*100
  BxMCV<-(sd(x[6:7])/mean(x[6:7]))*100
  acsCV<-(sd(x[8:10])/mean(x[8:10]))*100
  CV<--mean(c(B73CV, Mo17CV, BxMCV, acsCV))
  CV
}
```
```{r}
PE.CV<-apply(PE[,2:11], 1, function(x) avgCV(x))
names(PE.CV)<-PE[,1]
```
```{r}
FC.bm.mp<-function(x){
  #get mean of B73
  B73Mean<-mean(x[1:3])
  #get mean of Mo17
  Mo17Mean<-mean(x[4:5])
  #get mean of BxM
  BxMMean<-mean(x[6:7])
  #get midparent mean
  MP<-mean(c(B73Mean, Mo17Mean))
  #divide BxM by midparent mean
  ret<-log(BxMMean/MP, base=2)
  #return fold vector, with GI# as names
  return(ret)
}
```
```{r}
FC.acs.b73<-function(x){
  #get mean of B73
  B73Mean<-mean(x[1:3])
  #get mean of acs
  acsMean<-mean(x[8:10])
  ret<-log(B73Mean/acsMean, base=2)
  #return fold vector, with GI# as names
  return(ret)
}
```
```{r}
PE.FC.bm.mp <- apply(PE[,2:11], 1, function(x) FC.bm.mp(x))
PE.FC.acs.b73 <- apply(PE[,2:11], 1, function(x) FC.acs.b73(x))
```
```{r}
PE.FC.bm.mp.CV <- data.frame(cbind(PE.FC.bm.mp, PE.CV))
PE.FC.acs.b73.CV <- data.frame(cbind(PE.FC.acs.b73, PE.CV))
```
```{r}
colnames(PE.FC.bm.mp.CV) <- c("fold", "CV")
colnames(PE.FC.acs.b73.CV) <- c("fold", "CV")
```
```{r}
PE.df <- cbind(PE.FC.bm.mp.CV,PE.FC.acs.b73.CV)
```
```{r}
PE.df <- 
```


```{r}
library(cowplot)
```

```{r}
ggCVVolcano(PE.FC.bm.mp.CV)
```

```{r}
ggCVVolcano<-function(foldPvalDF, geneList=NULL, categories=NULL, title=NULL, zoom=c(2.5, -75)){
  #saturate down to max fold
  foldPvalDF[which(foldPvalDF[,"fold"]>zoom[1]),"fold"]<-zoom[1]
  foldPvalDF[which(foldPvalDF[,"fold"]<(-zoom[1])),"fold"]<--zoom[1]
  #saturate down to max CV
  foldPvalDF[which(foldPvalDF[,"CV"]<(-75)),"CV"]<--75
  #divide genes by membership in special list(s), if necessary
  pointShape<-1
  if(length(geneList)<1000&length(geneList)>0){pointShape<-19}
  if(length(geneList)>0){
    foldPvalDF<-foldPvalDF[which(foldPvalDF[,1]%in%geneList),]
  }
  #generate y and x axis limits for plots
    xlims<-c(-zoom[1], zoom[1])
    ylims<-c(0, zoom[2])
  #if more than one category, create factor
  if(length(categories)>0){
    foldPvalDF<-cbind(foldPvalDF, category = rep("Other", times=nrow(foldPvalDF)))
    #loop across categories, filling in values
    for(i in 1:length(categories)){
      foldPvalDF[which(foldPvalDF[,1]%in%categories[[i]]),4]<-names(categories[i])
    }
    foldPvalDF <- foldPvalDF[order(-as.numeric(factor(foldPvalDF[,4], levels=c(unique(names(categories)), "Other")))),]
    if(length(categories)==3){shapeVec<-(c(19, 1, 19, 19))}
    else{shapeVec<-c(19,19,19,19)}
    #if more than one category, color points based on membership
    #create scatter plot for central figure
    scatter<-ggplot(foldPvalDF, aes(x=foldPvalDF$fold, y=foldPvalDF$CV, color=foldPvalDF$category))+
    geom_point(aes(shape=category),alpha = 0.75)+
    scale_colour_manual(values=c("cyan3", "black", "red", "darkorange"))+
    scale_shape_manual(values=shapeVec)+
    geom_vline(xintercept=0, linetype="dashed", color = "gray50")+
    #geom_hline(yintercept=-20, linetype="dashed", color = "gray50")+
    ylim(rev(ylims))+
    xlim(xlims)+
    theme_classic()+
    theme(text = element_text(size=16), legend.position="bottom", legend.title=element_blank())+
    theme(plot.caption = element_text(hjust = 0.5, size=14))+
    guides(col=guide_legend(nrow=2,byrow=TRUE), shape=FALSE)+
    labs(x = "BxM/MP", y="-avg(CV)", color="Category", caption=title)
    #set up marginal density plot
    densityplot<-axis_canvas(scatter, axis="x")+
    geom_density(aes(fold, color=category), foldPvalDF, size=0.9)+
    scale_color_manual(values=c("cyan3", "black", "red", "darkorange"))+
    geom_vline(xintercept=0, linetype="dashed", color = "gray50")+
    theme_void()+
    theme(legend.title = element_blank())
    #put two plots together
    p <- insert_xaxis_grob(scatter, densityplot, position = "top")
    #save
    ggsave(plot=p, filename = "volcanoCVColor.tiff", device="tiff", dpi=600, width=6, height=6.83, compression = "lzw")
  }
  else{
    #if one category
    #set up scatter plot
    scatter<-ggplot(foldPvalDF, aes(x=foldPvalDF$fold, y=foldPvalDF$CV))+
    geom_point(alpha = 0.75, shape=pointShape)+
    scale_colour_manual(values=c("black"))+
    geom_vline(xintercept=0, linetype="dashed", color = "gray50")+
    #geom_hline(yintercept=-20, linetype="dashed", color = "gray50")+
    ylim(rev(ylims))+
    xlim(xlims)+
    theme_classic()+
    theme(text = element_text(size=16), legend.position="bottom", plot.caption = element_text(hjust = 0.5, size=14))+
    #theme(plot.margin = margin())+
    #guides(col=guide_legend(nrow=2,byrow=TRUE))+
    labs(x = "BxM/MP", y="-avg(CV)", caption=title)
    #set up marginal density plot
    densityplot<-axis_canvas(scatter, axis="x")+
    geom_density(aes(fold), foldPvalDF, size=0.9)+
    geom_vline(xintercept=0, linetype="dashed", color = "gray50")+
    scale_color_manual(values=c("black"))+
    theme_void()+
    theme(legend.title = element_blank())
    #put two plots together
    p <- insert_xaxis_grob(scatter, densityplot, position = "top")
    #save
    ggsave(plot=p, filename = "volcanoCV.tiff", device="tiff", dpi=600, width=6, height=6, compression = "lzw")
  }
}
```



```{r}
ggplot(PE.l2fc.cv.cbind, aes(x=AvgVal, y=cvVal, color=AvgVar)) +
  geom_point()+
  theme_light()+
  theme(legend.position="bottom")+
  xlab("log2(fc)")+
  ylab("cv")
```

```{r}
ggplot(data=test4, mapping = aes(x=test4$value, fill=variable))+
  geom_histogram(binwidth=.015, position="dodge")
```
```{r}
PE
```

