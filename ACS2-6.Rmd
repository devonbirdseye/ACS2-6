---
title: "ACS2/6"
author: "Devon Birdseye"
date: "10/3/2019"
output: BiocStyle::html_document
fig_width: 2
fig_height: 2
---
# Analysis of ACS2/6 mutant proteomics & comparison to BxM hybrid and inbreds

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
set.seed(586)
```
## libraries
```{r libraries, include=FALSE}
library(biomaRt)
library(reshape2)
library(scales)
library(tidyverse)
library(AnnotationFilter)
library(ggplot2)
library(topGO)
library(latexpdf)
require(reutils)
require(readr)
require(XML)
library(scales)
library(DESeq2)
library(pathview)
library(gage)
library(gageData)
library(KEGGREST)
library(dplyr)
library(tidyr)
library(gridExtra)
library(factoextra)
library(EnvStats)
```

```{r Read in data, eval=FALSE, echo=FALSE}
df <- read.csv("CSVs/B73-Mo17-BM-ACS26 TMT10 100319.csv", stringsAsFactors = F)
PrevSL <- read.csv("CSVs/Seedling Leaf TMT10 030419.csv", stringsAsFactors = F)
PrevSL_trim <- PrevSL[,c(16,17,2:10)]
colnames(PrevSL_trim) <- c("GI", "Protein", "b731", "b732", "b733", "mo171", "mo172", "mo173", "bm1", "bm2", "bm3")
```

```{r BiomartRefSeqPepFun FUN, eval=FALSE, echo=FALSE}
# Function to download sequence info from Biomart using Refseq protein vector input (biomaRt package)
host="plants.ensembl.org"
mysets<-listDatasets(useMart("plants_mart", host = host))
myusemart <- useDataset("zmays_eg_gene", mart = useMart("plants_mart", host = host))

BiomartRefSeqPepFun <- function(GeneVector){
  biomart <-  getBM(attributes=c("maizegdb", "refseq_peptide"), filters = ("refseq_peptide"), values = list(GeneVector), mart = myusemart)
  biomartNoMissingMaizeGDB <- biomart[!(biomart$maizegdb==""),]
biomartNoMissingMaizeGDB
}
```

```{r Create vector of RefSeq Peptide IDs, eval=FALSE, echo=FALSE}
#remove "decoy hits"
df_NoDecoys <- df[-grep("decoy",df$Protein),]
#substring to just accession
RefSeqPepV <- substr(df_NoDecoys$Protein, start = 5, stop = 18)
#Remove any letters
RefSeqPepV2 <- gsub("- [A-z]", "", RefSeqPepV)
#Make accession vector a new column on df_NoDecoys
df_NoDecoys$RefSeqPep <- RefSeqPepV2
```

```{r Convert accessions via biomart, eval=FALSE, echo=FALSE}
#Run Biomart pull function
AccConv <- BiomartRefSeqPepFun(df_NoDecoys$RefSeqPep)

#restructure result so that multiple maizegdb accessions get their own column, and each row is a unique RefSeqPep
AccConv <- AccConv %>%
  group_by(refseq_peptide) %>%
  mutate(maizegdbID = paste0('maizegdb.bm.', row_number())) %>%
  spread(maizegdbID, maizegdb)
#re-order rows
AccConv <- AccConv[,c(1,2,8:15,3:7)]

#Check stats for biomart accession conversion
print(paste0("Input NCBI proteins = ",length(RefSeqPepV)))
print(paste0("NCBI proteins with corresponding maizegdb IDs in Biomart = ",length(unique(AccConv$refseq_peptide))))
```

```{r Merge bm accessions back to df, eval=FALSE, echo=FALSE}
df_NoDecoys_Biomart <- merge.data.frame(df_NoDecoys, AccConv, by.x = "RefSeqPep", by.y = "refseq_peptide", all=T)
```

```{r Create GI vector, eval=FALSE, echo=FALSE}
###Use the epost/efetch functions written by Laura to pull maizegdb accessions from xml as well
options(stringsAsFactors = FALSE)

require(reutils)
require(readr)
require(XML)

#get GI accessions
giAccessions<-PrevSL_trim$GI
#remove gi accessions with alphas AKA nonconvertible
giAccessions<-giAccessions[-grep(giAccessions, pattern = "[a-zA-Z]")]
#trim to remove last two empty lines
giAccessions <- giAccessions[1:9196]
```

```{r epost, efetch, eval=FALSE, echo=FALSE}
#if re-running this, delete old copy of efetch.txt from file first
#first, convert GI to UID
#because more than 500, need to use epost first
p <- epost(giAccessions, db = "protein")
#efetch genpept file format for each UID, save to text file (requirement for epost>500)
efetch(p, db="protein",retmode = "text", rettype="gp", outfile = "efetch.txt")
```

```{r UID vec, eval=FALSE, echo=FALSE}
##Pause a couple seconds while the efetch.txt file synchs to cloud, then continue:

#read in UID text
UIDVec<-read.delim(file="efetch.txt", header = FALSE)
#convert to vector
UIDVec<-UIDVec[,1]
#get gene IDs from full flat file
UIDVec2<-UIDVec[grep(UIDVec, pattern="GeneID")]
#gsub out "GeneID:" to get accession number
UIDVec2<-gsub(UIDVec2, pattern=".*:", replacement = "")
#check that there is a UID for each GI
length(UIDVec2)==length(giAccessions)
```

```{r UID to Zm, eval=FALSE, echo=FALSE}
#since >500, need to use epost
#loop across total number of batches of 500
#post to epost, fetch each XML, create conversion table
#get number of batches
batches<-seq(1:ceiling(length(UIDVec2)/200))
batchEnd<-0
#create empty df
NCBIConvert<-NULL
#loop across batches
for(i in 1:length(batches)){
  batchStart<-batchEnd+1
  if(i<length(batches)){batchEnd<-batchEnd+200}else(batchEnd<-length(UIDVec2))
  print(batchEnd)
  f<-epost(UIDVec2[batchStart:batchEnd], db="gene")
  allXML2<-content(efetch(f, db="gene", retmode="xml"), as="xml")
  #pull out gene reference locus tag, if exists, if not, return "NA"
  dbxrefs1<-as.list(xpathApply(allXML2,"//Gene-ref", function(x) {
             if("Gene-ref_locus-tag" %in% names(x)){xmlValue(x[["Gene-ref_locus-tag"]])}
             else {NA}
              }))
  #gsub out "ZEAMMB73_"
  dbxrefs1<-gsub(dbxrefs1, pattern = "ZEAMMB73_", replacement = "")
  #turn into character vector
  dbxrefs1<-unlist(dbxrefs1)

    
  #now get UIDs back (to check for length of XML)
  dbxrefs2<-as.list(xpathApply(allXML2,"//Entrezgene_track-info/Gene-track",function(x) {
             if("Gene-track_geneid" %in% names(x)){xmlValue(x[["Gene-track_geneid"]])}
             else {NA}
              }))
  #turn into character vector
  dbxrefs2<-unlist(dbxrefs2)
  
  #check that original gi length == number of XML entries efetched
  200==length(dbxrefs2)
  #check that number of Zm accessions matches number of gi accessions
  200==length(dbxrefs1)

  #put together
  tmp<-cbind(giAccessions[batchStart:batchEnd], dbxrefs2, dbxrefs1)
  NCBIConvert<-rbind(NCBIConvert, tmp)
}
#rename columns
colnames(NCBIConvert)<-c("GI", "UID", "maizegdb.epost")

NCBIConvert2 <- as.data.frame(NCBIConvert)

#remove missing maizegdbid columns
NCBIConvert2 <- NCBIConvert2[!(NCBIConvert2$maizegdb.epost=="NA"),]
#Print stats
print(paste0("Input numeric GIs with a corresponding numeric UID = ",length((NCBIConvert2$GI))))
print(paste0("Unique MaizeGDB IDs returned = ",length(unique(NCBIConvert2$maizegdb.epost))))
```

```{r Merge Acc Conversion back with Data, eval=FALSE, echo=FALSE}
df_NoDecoys_Biomart_epost <- merge.data.frame(df_NoDecoys_Biomart, NCBIConvert2, by.x = "Accession", by.y = "GI", all=T)

##make new column for complete V4 accessions
#choose the epost ID if available
df_NoDecoys_Biomart_epost$V4 <- df_NoDecoys_Biomart_epost$maizegdb.epost
#if no epost ID, choose the 1st biomart ID
df_NoDecoys_Biomart_epost$V4[is.na(df_NoDecoys_Biomart_epost$V4)]<- df_NoDecoys_Biomart_epost$maizegdb.bm.1[is.na(df_NoDecoys_Biomart_epost$V4)]
#if no epost or biomart ID, choose the GI
df_NoDecoys_Biomart_epost$V4[is.na(df_NoDecoys_Biomart_epost$V4)]<- df_NoDecoys_Biomart_epost$Accession[is.na(df_NoDecoys_Biomart_epost$V4)]
```

```{r Merge Acc Conversion back with PrevSL_trim Data, eval=FALSE, echo=FALSE}
PrevSL_trim_epost <- merge.data.frame(PrevSL_trim, NCBIConvert2, by.x = "GI", by.y = "GI", all=T)

##make new column for complete V4 accessions
#choose the epost ID if available
PrevSL_trim_epost$V4 <- PrevSL_trim_epost$maizegdb.epost
```

```{r Save DF RDS, eval=FALSE, echo=FALSE}
saveRDS(df_NoDecoys_Biomart_epost, "df_NoDecoys_Biomart_epost")
saveRDS(PrevSL_trim_epost, "PrevSL_trim_epost")
```


# Re-start here after cleared environment
## Data import and editing

### Read DF RDS
```{r Read DF RDS}
df_NoDecoys_Biomart_epost <- readRDS("df_NoDecoys_Biomart_epost")
PrevSL_trim_epost2 <- readRDS("PrevSL_trim_epost")
```

### Re-order columns
```{r Re-order columns}
DF <- df_NoDecoys_Biomart_epost
DF<- DF[,c(1,2,42,44,18,3:12)]
colnames(DF)<- c("GI", "RefSeqPep", "UID", "V4", "Protein", "b731", "b732", "b733", "mo171", "mo172", "bm1", "bm2", "acs1", "acs2", "acs3")
```

### geomean functions
```{r geomean functions}
BMgeomean <- function(df){
  x <- NULL
  for(i in 1:nrow(df)){
    v <- as.numeric(df[i, 17:18])
    gm <- geoMean(v, na.rm = T)
    x[i]<-gm
  }
  x
}

PrevSL_BMgeomean <- function(df){
  x <- NULL
  for(i in 1:nrow(df)){
    v <- as.numeric(df[i, 18:20])
    gm <- geoMean(v, na.rm = T)
    x[i]<-gm
  }
  x
}

ACSgeomean <- function(df){
  x <- NULL
  for(i in 1:nrow(df)){
    v <- as.numeric(df[i, 19:21])
    gm <- geoMean(v, na.rm = T)
    x[i]<-gm
  }
  x
}
```

### Set mp, bm/mp, Avgs, and SDS
```{r Set mp, bm/mp, Avgs, and SDS}
DF$mp1 <- rowMeans(DF[,c(6,9)])

DF$bm1.mp1 <- DF$bm1/DF$mp1
DF$bm2.mp1 <- DF$bm2/DF$mp1

DF$acs1.b731 <- DF$acs1/DF$b731
DF$acs2.b732 <- DF$acs2/DF$b732
DF$acs3.b733 <- DF$acs3/DF$b733

DF$avg.bm.mp <- BMgeomean(DF)
DF$avg.acs.b73 <- ACSgeomean(DF)

DF$sds.bm.mp <- rowSds(as.matrix(DF[,17:18]), na.rm = T)
DF$sds.acs.b73 <- rowSds(as.matrix(DF[,19:21]), na.rm = T)
```

### Analyze PrevSL data
```{r analyze PrevSL data}
#Set NAs to 0
PrevSL_trim_epost2$b731[PrevSL_trim_epost2$b731==0]<-NA
PrevSL_trim_epost2$b732[PrevSL_trim_epost2$b732==0]<-NA
PrevSL_trim_epost2$b733[PrevSL_trim_epost2$b733==0]<-NA
PrevSL_trim_epost2$mo171[PrevSL_trim_epost2$mo171==0]<-NA
PrevSL_trim_epost2$mo172[PrevSL_trim_epost2$mo172==0]<-NA
PrevSL_trim_epost2$mo173[PrevSL_trim_epost2$mo173==0]<-NA
PrevSL_trim_epost2$bm1[PrevSL_trim_epost2$bm1==0]<-NA
PrevSL_trim_epost2$bm2[PrevSL_trim_epost2$bm2==0]<-NA
PrevSL_trim_epost2$bm3[PrevSL_trim_epost2$bm3==0]<-NA
# calc. mp values
PrevSL_trim_epost2$mp1 <- rowMeans(PrevSL_trim_epost2[,c(3,6)], na.rm = T)
PrevSL_trim_epost2$mp2 <- rowMeans(PrevSL_trim_epost2[,c(4,7)], na.rm = T)
PrevSL_trim_epost2$mp3 <- rowMeans(PrevSL_trim_epost2[,c(5,8)], na.rm = T)
#calc. ratios
PrevSL_trim_epost2$bm1.mp1 <- PrevSL_trim_epost2$bm1/PrevSL_trim_epost2$mp1
PrevSL_trim_epost2$bm2.mp2 <- PrevSL_trim_epost2$bm2/PrevSL_trim_epost2$mp2
PrevSL_trim_epost2$bm3.mp3 <- PrevSL_trim_epost2$bm3/PrevSL_trim_epost2$mp3
#calc average and standard dev
PrevSL_trim_epost2$avg.bm.mp <- PrevSL_BMgeomean(PrevSL_trim_epost2)
PrevSL_trim_epost2$sds.bm.mp <- rowSds(as.matrix(PrevSL_trim_epost2[,18:20]), na.rm = T)
```

```{r write table PrevSL l2fc for Corn Cyc analyses, eval=FALSE, echo=FALSE}
write.table(na.omit(PrevSL_trim_epost2[,c(14,23)]), "Prot_SL.txt", sep="\t", row.names = F, col.names = F)
```
### Subset to sig, above, and below
```{r Subset to sig, above, and below}
DF.acs.sig <- DF[(DF$sds.acs.b73<0.1),]
DF.bm.sig <- DF[(DF$sds.bm.mp<0.1),]

DF.acs.sig.10above <- DF.acs.sig[(DF.acs.sig$avg.acs.b73>1.1),]
DF.bm.sig.10above <- DF.bm.sig[(DF.bm.sig$avg.bm.mp>1.1),]

DF.acs.sig.10below <- DF.acs.sig[(DF.acs.sig$avg.acs.b73<0.9),]
DF.bm.sig.10below <- DF.bm.sig[(DF.bm.sig$avg.bm.mp<0.9),]

PrevSL_trim_epost2.bm.sig <- PrevSL_trim_epost2[(PrevSL_trim_epost2$sds.bm.mp<0.1),]
PrevSL_trim_epost2.bm.sig.10above <- PrevSL_trim_epost2.bm.sig[(PrevSL_trim_epost2.bm.sig$avg.bm.mp>1.1),]
PrevSL_trim_epost2.bm.sig.10below <- PrevSL_trim_epost2.bm.sig[(PrevSL_trim_epost2.bm.sig$avg.bm.mp<0.9),]
```

### calculate Log2(fold change)
```{r calculate Log2(fold change)}
DF$avg.bm.mp.l2fc <- log2(DF$avg.bm.mp)
DF$avg.acs.b73.l2fc <- log2(DF$avg.acs.b73)

DF$bm1.mp1.l2fc <- log2(DF$bm1.mp1)
DF$bm2.mp1.l2fc <- log2(DF$bm2.mp1)

DF$acs1.b731.l2fc <- log2(DF$acs1.b731)
DF$acs2.b732.l2fc <- log2(DF$acs2.b732)
DF$acs3.b733.l2fc <- log2(DF$acs3.b733)

PrevSL_trim_epost2$avg.bm.mp.l2fc <- log2(PrevSL_trim_epost2$avg.bm.mp)
PrevSL_trim_epost2$bm1.mp1.l2fc <- log2(PrevSL_trim_epost2$bm1.mp1)
PrevSL_trim_epost2$bm2.mp2.l2fc <- log2(PrevSL_trim_epost2$bm2.mp2)
PrevSL_trim_epost2$bm3.mp3.l2fc <- log2(PrevSL_trim_epost2$bm3.mp3)
```

### Subset without duplicate UIDs for KEGG
```{r Subset without duplicate UIDs for KEGG}
DF_NoDupUID <- DF[!(duplicated(DF$UID) | is.na(DF$UID)),]

nrow(DF)
nrow(DF_NoDupUID)
```

```{r Save l2fc data for CornCyc analysis, eval=FALSE, echo=FALSE}
DF_NoDupUID.txt <- DF_NoDupUID[,c(4,27)]
write.table(DF_NoDupUID.txt, "Prot_acs.txt", sep="\t", row.names = F, col.names = F)
```

### Subset PrevSL without duplicate UIDs for KEGG
```{r Subset PrevSL without duplicate UIDs for KEGG}
PrevSL_trim_epost2_NoDupUID <- PrevSL_trim_epost2[!(duplicated(PrevSL_trim_epost2$UID) | is.na(PrevSL_trim_epost2$UID)),]

nrow(PrevSL_trim_epost2)
nrow(PrevSL_trim_epost2_NoDupUID)
```

### subset to hyb and acs l2fc DFs for KEGG
```{r subset to hyb and acs l2fc DFs for KEGG}
DF.bm.l2fc <- DF_NoDupUID[,28:29]
DF.acs.l2fc <- DF_NoDupUID[,30:32]

rownames(DF.bm.l2fc) <- DF_NoDupUID$UID
rownames(DF.acs.l2fc) <- DF_NoDupUID$UID

#Remove the one row of NA - dont know where this came from (?)
DF.acs.sig.10below <- DF.acs.sig.10below[!(is.na(DF.acs.sig.10below$GI)),]
DF.acs.sig.10above <- DF.acs.sig.10above[!(is.na(DF.acs.sig.10above$GI)),]
```

### subset PrevSL to hyb and acs l2fc DFs for KEGG
```{r subset PrevSL to hyb and acs l2fc DFs for KEGG}
PrevSL_trim_epost2.bm.l2fc <- PrevSL_trim_epost2_NoDupUID[,24:26]
rownames(PrevSL_trim_epost2.bm.l2fc) <- PrevSL_trim_epost2_NoDupUID$UID

PrevSL_trim_epost2.bm.l2fc<- (na.omit(PrevSL_trim_epost2.bm.l2fc))
```


```{r Venn Diagrams, eval=FALSE, echo=FALSE}
VennDiagram::venn.diagram(list("BxM"=DF.bm.sig.10above$GI, "acs2/6"=DF.acs.sig.10above$GI), main = "Proteins 10% above expected (sd<0.1)", main.cex = 2, cex=2, cat.cex=1.5, filename = "DF10aboveVenn.png", ext.text=F, fill=c("orange", "yellow"), cat.pos=c(0,0), main.pos = c(0.5,0.95))

VennDiagram::venn.diagram(list("BxM"=DF.bm.sig.10below$GI, "acs2/6"=DF.acs.sig.10below$GI), main = "Proteins 10% below expected (sd<0.1)",main.cex = 2, cex=2, cat.cex=1.5, filename = "DF10belowVenn.png", ext.text=F, fill=c("orange", "yellow"), cat.pos=c(0,0), main.pos = c(0.5,0.95))
```
### Subset DFs to discrete sections of Venn Diagrams
```{r Subset DFs to discrete sections of Venn Diagrams}
DF.bm.AND.acs.sig.10above <- DF.bm.sig.10above[(DF.bm.sig.10above$GI%in%DF.acs.sig.10above$GI),]
DF.bm.NOT.acs.sig.10above <- DF.bm.sig.10above[!(DF.bm.sig.10above$GI%in%DF.acs.sig.10above$GI),]
DF.acs.NOT.bm.sig.10above <- DF.acs.sig.10above[!(DF.acs.sig.10above$GI%in%DF.bm.sig.10above$GI),]

DF.bm.AND.acs.sig.10below <- DF.bm.sig.10below[(DF.bm.sig.10below$GI%in%DF.acs.sig.10below$GI),]
DF.bm.NOT.acs.sig.10below <- DF.bm.sig.10below[!(DF.bm.sig.10below$GI%in%DF.acs.sig.10below$GI),]
DF.acs.NOT.bm.sig.10below <- DF.acs.sig.10below[!(DF.acs.sig.10below$GI%in%DF.bm.sig.10below$GI),]

#check that we got everything
(nrow(DF.bm.AND.acs.sig.10above)+nrow(DF.bm.NOT.acs.sig.10above)+nrow(DF.acs.NOT.bm.sig.10above))==(length(unique(c(DF.bm.sig.10above$GI,DF.acs.sig.10above$GI))))

(nrow(DF.bm.AND.acs.sig.10below)+nrow(DF.bm.NOT.acs.sig.10below)+nrow(DF.acs.NOT.bm.sig.10below))==(length(unique(c(DF.bm.sig.10below$GI,DF.acs.sig.10below$GI))))
```

# KEGG
## Pathview and GAGE to create KEGG maps

### Define gsets and run gage on acs and hyb
```{r Define gsets and run gage on acs and hyb}
zma <- kegg.gsets(species = "zma", id.type = "entrez")

keggres_HYB_DF <- gage(DF.bm.l2fc, gsets = zma$kg.sets, samp = c(1:2), same.dir = T)
keggres_ACS_DF <- gage(DF.acs.l2fc, gsets = zma$kg.sets, samp = c(1:3), same.dir = T)
keggres_PrevSL_DF <- gage(PrevSL_trim_epost2.bm.l2fc, gsets = zma$kg.sets, samp = c(1:3), same.dir = T)
```

### PVfun
```{r PVfun}
PVfun <- function(keggres, foldchangev){
  dir.create(paste0((deparse(substitute(keggres))), "_",(deparse(substitute(foldchangev))),"/"))
setwd(paste0((deparse(substitute(keggres))), "_",(deparse(substitute(foldchangev))),"/"))
keggres_df = as.data.frame(keggres)
keggres_df_sig = na.omit(keggres_df[(keggres_df$p.val<0.05),])

V = rownames(keggres_df_sig)
Va = substr(V, start = 1, stop = 8)
Vb = substr(V, start = 10, stop = 100)
Vm =cbind(Va, Vb)

for(i in 1:nrow(Vm)){
  pathview(gene.data=foldchangev, pathway.id=Vm[i,1], species = "zma", out.suffix = (paste0(Vm[i,2], (deparse(substitute(keggres))))))
  }
}
```


```{r PVfun run, eval=FALSE, echo=FALSE}
PVfun(keggres_PrevSL_DF$greater, PrevSL_trim_epost2.bm.l2fc)
PVfun(keggres_PrevSL_DF$less, PrevSL_trim_epost2.bm.l2fc)

PVfun(keggres_HYB_DF$greater, DF.bm.l2fc)
PVfun(keggres_HYB_DF$less, DF.bm.l2fc)

PVfun(keggres_ACS_DF$greater, DF.acs.l2fc)
PVfun(keggres_ACS_DF$less, DF.acs.l2fc)

pathview(PrevSL_trim_epost2.bm.l2fc, pathway.id = "zma00010", species = "zma", out.suffix = "keggres_PrevSL_DF$less_Glycolysis")
```


```{r Make .png images of KEGG pathway enrichment dataframes, eval=FALSE, echo=FALSE}
keggres_HYB_DF_KEGGdf <- as.data.frame(keggres_HYB_DF$greater)
keggres_HYB_DF_KEGGdf$KEGG <- rownames(keggres_HYB_DF_KEGGdf)
keggres_HYB_DF_KEGGdf <- keggres_HYB_DF_KEGGdf[1:6,c(8,1:7)]

png((paste0(c(deparse(substitute(keggres_HYB_DF_KEGGdf.greater))),".png")), height=300, width=1000)
p<-tableGrob(keggres_HYB_DF_KEGGdf, rows = c())
grid.arrange(p)
dev.off()

keggres_ACS_DF_KEGGdf <- as.data.frame(keggres_ACS_DF$greater)
keggres_ACS_DF_KEGGdf$KEGG <- rownames(keggres_ACS_DF_KEGGdf)
keggres_ACS_DF_KEGGdf <- keggres_ACS_DF_KEGGdf[1:6,c(9,1:8)]

png((paste0(c(deparse(substitute(keggres_ACS_DF_KEGGdf.greater))),".png")), height=300, width=1000)
p<-tableGrob(keggres_ACS_DF_KEGGdf, rows = c())
grid.arrange(p)
dev.off()

keggres_PrevSL_DF_KEGGdf <- as.data.frame(keggres_PrevSL_DF$greater)
keggres_PrevSL_DF_KEGGdf$KEGG <- rownames(keggres_PrevSL_DF_KEGGdf)
keggres_PrevSL_DF_KEGGdf <- keggres_PrevSL_DF_KEGGdf[1:6,c(9,1:8)]

png((paste0(c(deparse(substitute(keggres_PrevSL_DF_KEGGdf.greater))),".png")), height=300, width=1000)
p<-tableGrob(keggres_PrevSL_DF_KEGGdf, rows = c())
grid.arrange(p)
dev.off()

keggres_HYB_DF_KEGGdf <- as.data.frame(keggres_HYB_DF$less)
keggres_HYB_DF_KEGGdf$KEGG <- rownames(keggres_HYB_DF_KEGGdf)
keggres_HYB_DF_KEGGdf <- keggres_HYB_DF_KEGGdf[1:10,c(8,1:7)]

png((paste0(c(deparse(substitute(keggres_HYB_DF_KEGGdf.less))),".png")), height=300, width=1000)
p<-tableGrob(keggres_HYB_DF_KEGGdf, rows = c())
grid.arrange(p)
dev.off()

keggres_ACS_DF_KEGGdf <- as.data.frame(keggres_ACS_DF$less)
keggres_ACS_DF_KEGGdf$KEGG <- rownames(keggres_ACS_DF_KEGGdf)
keggres_ACS_DF_KEGGdf <- keggres_ACS_DF_KEGGdf[1:10,c(9,1:8)]

png((paste0(c(deparse(substitute(keggres_ACS_DF_KEGGdf.less))),".png")), height=300, width=1000)
p<-tableGrob(keggres_ACS_DF_KEGGdf, rows = c())
grid.arrange(p)
dev.off()

keggres_PrevSL_DF_KEGGdf <- as.data.frame(keggres_PrevSL_DF$less)
keggres_PrevSL_DF_KEGGdf$KEGG <- rownames(keggres_PrevSL_DF_KEGGdf)
keggres_PrevSL_DF_KEGGdf <- keggres_PrevSL_DF_KEGGdf[1:6,c(9,1:8)]

png((paste0(c(deparse(substitute(keggres_PrevSL_DF_KEGGdf.less))),".png")), height=300, width=1000)
p<-tableGrob(keggres_PrevSL_DF_KEGGdf, rows = c())
grid.arrange(p)
dev.off()
```

```{r KEGG:AminoAcidBio, eval=FALSE, echo=FALSE}
BiosynthesisAAs <- pathview(gene.data = DF.bm.l2fc, pathway.id = "zma01230", species="zma", out.suffix = "BiosynthesisAAs_HYB", keys.align = "y", kegg.native = F, match.data = F, multi.state = T, same.layer = T, cex=0.125, afactor=3, map.null = T, expand.node = T)
```


# GO analysis
## TopGO and Gamer

```{r gamer_ReadIn, include=FALSE, eval=FALSE, echo=FALSE}
# Read in Maize GAMER GO dataset, which lists V4 accessions with all associated GO terms (Wimalanathan et al. 2018) downloaded from doi.org/10.7946/P2M925
#unzip("maize.B73.AGPv4.aggregate.gaf.zip")
GAMER <- read.delim("maize.B73.AGPv4.aggregate.gaf", sep = "\t", header = FALSE, stringsAsFactors = F)
colnames(GAMER) <- c("db", "db_object_id", "db_object_symbol", "qualifier", "term_accession", "db_reference", "evidence_code", "with", "aspect", "db_object_name", "db_object_synonym", "db_object_type", "taxon", "date", "assigned_by", "annotation_extension", "gene_product_form_id")
saveRDS(GAMER, "GAMER")
```
### gamer cut
```{r gamer cut}
GAMER <- readRDS("GAMER")
gamer <- GAMER[-(1:2),]
gamer$Term <- Term(as.character(gamer$term_accession))

#Make gamer dataframe trimmed to only proteins detected in this run to use as background control set for enrichment analyses (input for "GamerCut" in GOanalysisGodata function)
GamerCut <- gamer[(gamer$db_object_id %in% DF$V4),]
GamerCut_PrevSL <- gamer[(gamer$db_object_id %in% PrevSL_trim_epost2$V4),]
```

### define GO:photosynthesis genes and GO:ribosome genes
```{r define GO:photosynthesis genes and GO:ribosome genes}
go.photosynthesis <- na.omit(gamer[(gamer$Term=="photosynthesis"),])
accessions.go.photosynthesis <- go.photosynthesis$db_object_id

go.ribosome <- na.omit(gamer[(gamer$Term=="ribosome"),])
accessions.go.ribosome <- go.ribosome$db_object_id
```

### GOanalysis functions
```{r GOanalysis functions}
## Build GOdata object
# EnrichedDF = DF with V4 accessions for GOIs in column named "V4"
# GamerCut = GAMER dataframe trimmed to control set
# ont = "BP", "MF", or "CC"
GOanalysisGodata <- function(EnrichedDF, GamerCut, ont, nodesize = 1){
  gene2GO_TissueCut <- split((as.character(GamerCut$term_accession)),GamerCut$db_object_id)
  gene2GOb_TissueCut <- gene2GO_TissueCut[-2]
  str(head(gene2GOb_TissueCut))
  geneNames_tissuecut <- names(gene2GOb_TissueCut)
  myInterestingGenes <- EnrichedDF$V4
  myInterestingGenes <- na.omit(myInterestingGenes)
  geneList <- factor(as.integer(geneNames_tissuecut %in% myInterestingGenes))
  names(geneList) <- geneNames_tissuecut
  GOdata <- new("topGOdata", ontology = ont, allGenes = geneList, annot = annFUN.gene2GO, nodeSize=nodesize, gene2GO = gene2GOb_TissueCut)
  GOdata
}

## GO analysis function to generate dataframe summary of top 20 of GO terms
# GOdata = Godata object (output of GoanalysisGodata function)

GOanalysisDF <- function(GOdata){
resultFis <- runTest(GOdata, algorithm = "classic", statistic = "fisher")
test.statF <- new("classicCount", testStatistic = GOFisherTest, name = "Fisher test")
resultFisher <- getSigGroups(GOdata, test.statF)
test.statKS <- new("classicScore", testStatistic = GOKSTest, name = "KS tests")
resultKS <- getSigGroups(GOdata, test.statKS)
test.statRW <- new("weightCount", testStatistic = GOFisherTest, name = "Fisher test", sigRatio = "ratio")
resultWeight <- getSigGroups(GOdata, test.statRW)
DF <- GenTable(GOdata, classic = resultFis, KS = resultKS, weight = resultWeight, orderBy = "classic", ranksOf = "classic", topNodes = 100)
DF
}

GOanalysisDF.list <- function(l){
  dir.create("GOdata.DFs/")
  setwd("GOdata.DFs/")
  l2 <- list(NULL)
  for(i in 1:length(l)){
   DF <- GOanalysisDF(l[[i]])
  png((paste0((names(l[i])), ".png")), height = 300, width=900)
  p<-tableGrob(DF[1:10,], rows = c())
  grid.arrange(p)
  dev.off()
  l2[[i]]<-DF
  }
  names(l2)<- names(l)
  l2
}

## GO analysis function to build map of top GO terms, output to pdf
# GOdata = Godata object (output of GoanalysisGodata function)
GOanalysisMap <- function(GOdata, nodes=10){
  resultFis <- runTest(GOdata, algorithm = "classic", statistic = "fisher")
  printGraph(GOdata, resultFis, firstSigNodes = nodes, fn.prefix = (paste0(c(deparse(substitute(GOdata))),".png")), useInfo = "all", pdfSW = TRUE)
}
```

```{r GO analyses, eval=FALSE, echo=FALSE}
#above
DF.acs.sig.10above.godataBP <- GOanalysisGodata(DF.acs.sig.10above, GamerCut, "BP")
DF.bm.sig.10above.godataBP <- GOanalysisGodata(DF.bm.sig.10above, GamerCut, "BP")

DF.acs.sig.10above.godataCC <- GOanalysisGodata(DF.acs.sig.10above, GamerCut, "CC")
DF.bm.sig.10above.godataCC <- GOanalysisGodata(DF.bm.sig.10above, GamerCut, "CC")

DF.acs.sig.10above.godataMF <- GOanalysisGodata(DF.acs.sig.10above, GamerCut, "MF")
DF.bm.sig.10above.godataMF <- GOanalysisGodata(DF.bm.sig.10above, GamerCut, "MF")

#below
DF.acs.sig.10below.godataBP <- GOanalysisGodata(DF.acs.sig.10below, GamerCut, "BP")
DF.bm.sig.10below.godataBP <- GOanalysisGodata(DF.bm.sig.10below, GamerCut, "BP")

DF.acs.sig.10below.godataCC <- GOanalysisGodata(DF.acs.sig.10below, GamerCut, "CC")
DF.bm.sig.10below.godataCC <- GOanalysisGodata(DF.bm.sig.10below, GamerCut, "CC")

DF.acs.sig.10below.godataMF <- GOanalysisGodata(DF.acs.sig.10below, GamerCut, "MF")
DF.bm.sig.10below.godataMF <- GOanalysisGodata(DF.bm.sig.10below, GamerCut, "MF")

GOdata.list <- list("DF.acs.sig.10above.godataBP"=DF.acs.sig.10above.godataBP, "DF.bm.sig.10above.godataBP"=DF.bm.sig.10above.godataBP, "DF.acs.sig.10above.godataCC"=DF.acs.sig.10above.godataCC, "DF.bm.sig.10above.godataCC"=DF.bm.sig.10above.godataCC, "DF.acs.sig.10above.godataMF"=DF.acs.sig.10above.godataMF,"DF.bm.sig.10above.godataMF"=DF.bm.sig.10above.godataMF,
"DF.acs.sig.10below.godataBP"=DF.acs.sig.10below.godataBP, "DF.bm.sig.10below.godataBP"=DF.bm.sig.10below.godataBP, "DF.acs.sig.10below.godataCC"=DF.acs.sig.10below.godataCC, "DF.bm.sig.10below.godataCC"=DF.bm.sig.10below.godataCC, "DF.acs.sig.10below.godataMF"=DF.acs.sig.10below.godataMF,"DF.bm.sig.10below.godataMF"=DF.bm.sig.10below.godataMF)
#Save GOdata list
saveRDS(GOdata.list, "GOdata.list")
#Build GO term enrichment tables
GO.DF.l <- GOanalysisDF.list(GOdata.list)
#Save list of GO term enrichment tables
saveRDS(GO.DF.l, "GO.DF.l")
```
### Read back in analyzed data
```{r}
#Load back in GOdata list and GO term enrichment table list
GOdata.list <- readRDS("GOdata.list")
GO.DF.l <- readRDS("GO.DF.l")
```

### printDFs function
```{r printDFs function}
printDFs <- function(l){
for(i in 1:length(l)){
  print(names(l[i]))
  print((l[[i]][1:10,1:6]))}
}
```

### GO-term enrichment tables
```{r}
printDFs(GO.DF.l)
```


```{r GO analysis venn diagram sections, eval=FALSE, echo=FALSE}
#above
DF.bm.AND.acs.sig.10above_GodataBP <- GOanalysisGodata(DF.bm.AND.acs.sig.10above, GamerCut, "BP")
DF.bm.NOT.acs.sig.10above_GodataBP <- GOanalysisGodata(DF.bm.NOT.acs.sig.10above, GamerCut, "BP")
DF.acs.NOT.bm.sig.10above_GodataBP <- GOanalysisGodata(DF.acs.NOT.bm.sig.10above, GamerCut, "BP")

DF.bm.AND.acs.sig.10above_GodataCC <- GOanalysisGodata(DF.bm.AND.acs.sig.10above, GamerCut, "CC")
DF.bm.NOT.acs.sig.10above_GodataCC <- GOanalysisGodata(DF.bm.NOT.acs.sig.10above, GamerCut, "CC")
DF.acs.NOT.bm.sig.10above_GodataCC <- GOanalysisGodata(DF.acs.NOT.bm.sig.10above, GamerCut, "CC")

DF.bm.AND.acs.sig.10above_GodataMF <- GOanalysisGodata(DF.bm.AND.acs.sig.10above, GamerCut, "MF")
DF.bm.NOT.acs.sig.10above_GodataMF <- GOanalysisGodata(DF.bm.NOT.acs.sig.10above, GamerCut, "MF")
DF.acs.NOT.bm.sig.10above_GodataMF <- GOanalysisGodata(DF.acs.NOT.bm.sig.10above, GamerCut, "MF")

#below
DF.bm.AND.acs.sig.10below_GodataBP <- GOanalysisGodata(DF.bm.AND.acs.sig.10below, GamerCut, "BP")
DF.bm.NOT.acs.sig.10below_GodataBP <- GOanalysisGodata(DF.bm.NOT.acs.sig.10below, GamerCut, "BP")
DF.acs.NOT.bm.sig.10below_GodataBP <- GOanalysisGodata(DF.acs.NOT.bm.sig.10below, GamerCut, "BP")

DF.bm.AND.acs.sig.10below_GodataCC <- GOanalysisGodata(DF.bm.AND.acs.sig.10below, GamerCut, "CC")
DF.bm.NOT.acs.sig.10below_GodataCC <- GOanalysisGodata(DF.bm.NOT.acs.sig.10below, GamerCut, "CC")
DF.acs.NOT.bm.sig.10below_GodataCC <- GOanalysisGodata(DF.acs.NOT.bm.sig.10below, GamerCut, "CC")

DF.bm.AND.acs.sig.10below_GodataMF <- GOanalysisGodata(DF.bm.AND.acs.sig.10below, GamerCut, "MF")
DF.bm.NOT.acs.sig.10below_GodataMF <- GOanalysisGodata(DF.bm.NOT.acs.sig.10below, GamerCut, "MF")
DF.acs.NOT.bm.sig.10below_GodataMF <- GOanalysisGodata(DF.acs.NOT.bm.sig.10below, GamerCut, "MF")

GOdata.venn.list <- list("DF.bm.AND.acs.sig.10above_GodataBP"=DF.bm.AND.acs.sig.10above_GodataBP,"DF.bm.NOT.acs.sig.10above_GodataBP"=DF.bm.NOT.acs.sig.10above_GodataBP, "DF.acs.NOT.bm.sig.10above_GodataBP"=DF.acs.NOT.bm.sig.10above_GodataBP, "DF.bm.AND.acs.sig.10above_GodataCC"=DF.bm.AND.acs.sig.10above_GodataCC, "DF.bm.NOT.acs.sig.10above_GodataCC"=DF.bm.NOT.acs.sig.10above_GodataCC, "DF.acs.NOT.bm.sig.10above_GodataCC"=DF.acs.NOT.bm.sig.10above_GodataCC, "DF.bm.AND.acs.sig.10above_GodataMF"=DF.bm.AND.acs.sig.10above_GodataMF, "DF.bm.NOT.acs.sig.10above_GodataMF"=DF.bm.NOT.acs.sig.10above_GodataMF, "DF.acs.NOT.bm.sig.10above_GodataMF"=DF.acs.NOT.bm.sig.10above_GodataMF, "DF.bm.AND.acs.sig.10below_GodataBP"=DF.bm.AND.acs.sig.10below_GodataBP, "DF.bm.NOT.acs.sig.10below_GodataBP"=DF.bm.NOT.acs.sig.10below_GodataBP, "DF.acs.NOT.bm.sig.10below_GodataBP"=DF.acs.NOT.bm.sig.10below_GodataBP, "DF.bm.AND.acs.sig.10below_GodataCC"=DF.bm.AND.acs.sig.10below_GodataCC, "DF.bm.NOT.acs.sig.10below_GodataCC"=DF.bm.NOT.acs.sig.10below_GodataCC, "DF.acs.NOT.bm.sig.10below_GodataCC"=DF.acs.NOT.bm.sig.10below_GodataCC, "DF.bm.AND.acs.sig.10below_GodataMF"=DF.bm.AND.acs.sig.10below_GodataMF, "DF.bm.NOT.acs.sig.10below_GodataMF"=DF.bm.NOT.acs.sig.10below_GodataMF, "DF.acs.NOT.bm.sig.10below_GodataMF"=DF.acs.NOT.bm.sig.10below_GodataMF)
#Save GOdata list
saveRDS(GOdata.venn.list, "GOdata.venn.list")
#Build GO term enrichment tables
GO.venn.DF.l <- GOanalysisDF.list(GOdata.venn.list)
#Save list of GO term enrichment tables
saveRDS(GO.venn.DF.l, "GO.venn.DF.l")
```

### Read back in analyzed data
```{r}
#Load back in GOdata list and GO term enrichment table list
GOdata.venn.list <- readRDS("GOdata.venn.list")
GO.venn.DF.l <- readRDS("GO.venn.DF.l")
```
### Venn diagram discrete sections GO-term enrichments
```{r}
printDFs(GO.venn.DF.l)
```


# Distance matrices to analyze bio replicates
## Build distance matrix of bio reps
```{r}
#Build distance matrix of bio reps
df_NoDecoys_Biomart_epost_bioreps <- df_NoDecoys_Biomart_epost
df_NoDecoys_Biomart_epost_bioreps <- df_NoDecoys_Biomart_epost_bioreps[,c(3:12)]
colnames(df_NoDecoys_Biomart_epost_bioreps)<- c("b73.1", "b73.2", "b73.3", "mo17.1", "mo17.2", "BM.1", "BM.2", "acs.1", "acs.2", "acs.3")
df_NoDecoys_Biomart_epost_bioreps <- t(df_NoDecoys_Biomart_epost_bioreps)
dist_bioreps <- dist(df_NoDecoys_Biomart_epost_bioreps, method = "euclidean")
dist_bioreps
```
## Plot distance matrix 
```{r}
#Plot distance matrix - bio reps
res.dist_bioreps <- factoextra::get_dist(df_NoDecoys_Biomart_epost_bioreps, stand = F, method = "euclidian")
factoextra::fviz_dist(res.dist_bioreps, 
   gradient = list(low = "#00AFBB", mid = "white", high = "#FC4E07"), order = T)

ggsave("bioreps_dist.png")
```
## build heirarchical clustering
```{r}
#build heirarchical clustering - bio reps
hc_bioreps<- hclust(dist_bioreps, method = "ward.D2")
hcd_bioreps <- as.dendrogram(hc_bioreps)
plot(hcd_bioreps, type = "rectangle", ylab = "height")
```

## Build distance matrix of bio reps - plastid-encoded
```{r}
#Build distance matrix of bio reps
df_NoDecoys_Biomart_epost_bioreps_plastid <- df_NoDecoys_Biomart_epost
df_NoDecoys_Biomart_epost_bioreps_plastid <- df_NoDecoys_Biomart_epost_bioreps_plastid[grep("NP_04",df_NoDecoys_Biomart_epost_bioreps_plastid$Protein),]
df_NoDecoys_Biomart_epost_bioreps_plastid <- df_NoDecoys_Biomart_epost_bioreps_plastid[,c(3:12)]
colnames(df_NoDecoys_Biomart_epost_bioreps_plastid)<- c("b73.1", "b73.2", "b73.3", "mo17.1", "mo17.2", "BM.1", "BM.2", "acs.1", "acs.2", "acs.3")
df_NoDecoys_Biomart_epost_bioreps_plastid <- t(df_NoDecoys_Biomart_epost_bioreps_plastid)
dist_bioreps_plastid <- dist(df_NoDecoys_Biomart_epost_bioreps_plastid, method = "euclidean")
dist_bioreps_plastid
```
## Plot distance matrix - plastid-encoded
```{r}
#Plot distance matrix - bio reps
res.dist_bioreps <- factoextra::get_dist(df_NoDecoys_Biomart_epost_bioreps_plastid, stand = F, method = "euclidian")
factoextra::fviz_dist(res.dist_bioreps, 
   gradient = list(low = "#00AFBB", mid = "white", high = "#FC4E07"), order = T)
ggsave("bioreps_plastid_dist.png")
```
## build heirarchical clustering - plastid-encoded
```{r}
#build heirarchical clustering - bio reps
hc_bioreps_plastid<- hclust(dist_bioreps_plastid, method = "ward.D2")
hcd_bioreps_plastid <- as.dendrogram(hc_bioreps_plastid)
plot(hcd_bioreps_plastid, type = "rectangle", ylab = "height")
```

## Build distance matrix of bio reps - GO:photosynthesis
```{r}
#Build distance matrix of bio reps
df_NoDecoys_Biomart_epost_bioreps_go.photo<- df_NoDecoys_Biomart_epost
df_NoDecoys_Biomart_epost_bioreps_go.photo <- df_NoDecoys_Biomart_epost_bioreps_go.photo[(df_NoDecoys_Biomart_epost_bioreps_go.photo$V4%in%accessions.go.photosynthesis),]
df_NoDecoys_Biomart_epost_bioreps_go.photo <- df_NoDecoys_Biomart_epost_bioreps_go.photo[,c(3:12)]
colnames(df_NoDecoys_Biomart_epost_bioreps_go.photo)<- c("b73.1", "b73.2", "b73.3", "mo17.1", "mo17.2", "BM.1", "BM.2", "acs.1", "acs.2", "acs.3")
df_NoDecoys_Biomart_epost_bioreps_go.photo <- t(df_NoDecoys_Biomart_epost_bioreps_go.photo)
dist_bioreps_go.photo <- dist(df_NoDecoys_Biomart_epost_bioreps_go.photo, method = "euclidean")
dist_bioreps_go.photo
```
## Plot distance matrix - GO:photosynthesis
```{r}
#Plot distance matrix - bio reps
res.dist_bioreps <- factoextra::get_dist(df_NoDecoys_Biomart_epost_bioreps_go.photo, stand = F, method = "euclidian")
factoextra::fviz_dist(res.dist_bioreps, 
   gradient = list(low = "#00AFBB", mid = "white", high = "#FC4E07"))
ggsave("bioreps_nuclear_GO_photo_dist.png")
```
## build heirarchical clustering - GO:photosynthesis
```{r }
#build heirarchical clustering - bio reps
hc_bioreps_go.photo<- hclust(dist_bioreps_go.photo)
hcd_bioreps_go.photo <- as.dendrogram(hc_bioreps_go.photo)
plot(hcd_bioreps_go.photo, type = "rectangle", ylab = "height")
```

## Build distance matrix of bio reps - "ribosomal protein"
```{r}
#Build distance matrix of bio reps
df_NoDecoys_Biomart_epost_bioreps_go.ribosome<- df_NoDecoys_Biomart_epost
df_NoDecoys_Biomart_epost_bioreps_go.ribosome <- df_NoDecoys_Biomart_epost_bioreps_go.ribosome[grep("ribosomal protein",df_NoDecoys_Biomart_epost_bioreps_go.ribosome$Protein),]
df_NoDecoys_Biomart_epost_bioreps_go.ribosome <- df_NoDecoys_Biomart_epost_bioreps_go.ribosome[,c(3:12)]
colnames(df_NoDecoys_Biomart_epost_bioreps_go.ribosome)<- c("b73.1", "b73.2", "b73.3", "mo17.1", "mo17.2", "BM.1", "BM.2", "acs.1", "acs.2", "acs.3")
df_NoDecoys_Biomart_epost_bioreps_go.ribosome <- t(df_NoDecoys_Biomart_epost_bioreps_go.ribosome)
dist_bioreps_go.ribosome <- dist(df_NoDecoys_Biomart_epost_bioreps_go.ribosome, method = "euclidean", diag=T, upper=T)
dist_bioreps_go.ribosome
```
## Plot distance matrix - "ribosomal protein"
```{r}
#Plot distance matrix - bio reps
res.dist_bioreps <- factoextra::get_dist(df_NoDecoys_Biomart_epost_bioreps_go.ribosome, stand = F, method = "euclidian")
factoextra::fviz_dist(res.dist_bioreps, 
   gradient = list(low = "#00AFBB", mid = "white", high = "#FC4E07"))
ggsave("bioreps_nuclear_GO_ribosome_dist.png")
```
## build heirarchical clustering - "ribosomal protein"
```{r}
#build heirarchical clustering - bio reps
hc_bioreps_go.ribosome<- hclust(dist_bioreps_go.ribosome)
hcd_bioreps_go.ribosome <- as.dendrogram(hc_bioreps_go.ribosome)
plot(hcd_bioreps_go.ribosome, type = "rectangle", ylab = "height")
```

# heatmaps 
```{r}
library(RColorBrewer)
```
## build matrices
```{r}
dist_bioreps_go.ribosome.m <- as.matrix(dist_bioreps_go.ribosome)
dist_bioreps_go.photo.m <- as.matrix(dist_bioreps_go.photo)
dist_bioreps_plastid.m <- as.matrix(dist_bioreps_plastid)
dist_bioreps.m <- as.matrix(dist_bioreps)
```
## heatmap:all
```{r}
heatmap(dist_bioreps.m, col =colorRampPalette(brewer.pal(8, "Blues"))(25), symm = T)
```
## heatmap:plastid-encoded
```{r}
heatmap(dist_bioreps_plastid.m, col =colorRampPalette(brewer.pal(8, "Blues"))(25), symm = T)
```
## heatmap:GO:photosynthesis
```{r}
heatmap(dist_bioreps_go.photo.m, col =colorRampPalette(brewer.pal(8, "Blues"))(25), symm = T)
```
## heatmap:ribosome
```{r}
heatmap(dist_bioreps_go.ribosome.m, col =colorRampPalette(brewer.pal(8, "Blues"))(25), symm = T)
```

# heatmaps of individual protein expression
## heatmap:all
```{r}
df_NoDecoys_Biomart_epost_bioreps.t <- t(df_NoDecoys_Biomart_epost_bioreps)
heatmap(df_NoDecoys_Biomart_epost_bioreps.t)
```
## heatmap:plastid-encoded
```{r}
df_NoDecoys_Biomart_epost_bioreps_plastid.t <- t(df_NoDecoys_Biomart_epost_bioreps_plastid)
heatmap(df_NoDecoys_Biomart_epost_bioreps_plastid.t)
```
## heatmap:GO:photosynthesis
```{r}
df_NoDecoys_Biomart_epost_bioreps_go.photo.t <- t(df_NoDecoys_Biomart_epost_bioreps_go.photo)
heatmap(df_NoDecoys_Biomart_epost_bioreps_go.photo.t)
```
## heatmap:ribosome
```{r}
df_NoDecoys_Biomart_epost_bioreps_go.ribosome.t <- t(df_NoDecoys_Biomart_epost_bioreps_go.ribosome)
heatmap(df_NoDecoys_Biomart_epost_bioreps_go.ribosome.t)
```


# PlotExp function
```{r PlotExp function}
PlotExp <- function(V4acc){
b73 <- df_NoDecoys_Biomart_epost[((as.character(df_NoDecoys_Biomart_epost$V4))==V4acc), 3:5]
mo17 <- df_NoDecoys_Biomart_epost[((as.character(df_NoDecoys_Biomart_epost$V4))==V4acc), 6:7]
hyb <- df_NoDecoys_Biomart_epost[((as.character(df_NoDecoys_Biomart_epost$V4))==V4acc), 8:9]
acs <- df_NoDecoys_Biomart_epost[((as.character(df_NoDecoys_Biomart_epost$V4))==V4acc), 10:12]
all4 <- c(as.numeric(b73[1,]), as.numeric(mo17[1,]), as.numeric(hyb[1,]), as.numeric(acs[1,]))
all4df <- data.frame(sample=(c("b73.1", "b73.2", "b73.3", "mo17.1", "mo17.2", "hyb.1", "hyb.2", "acs.1", "acs.2", "acs.3")), TMT=all4)
all4df$sample <- factor(all4df$sample, levels = all4df$sample)
ggplot(data=all4df, aes(x=sample, y=TMT, width=0.75)) + geom_bar(stat="identity", fill = c("blue3", "blue3", "blue3", "red3", "red3",  "purple4", "purple4", "green3", "green3", "green3")) + labs(title=V4acc)
}
```
## Plotting genes
```{r}
PlotExp("Zm00001d045479")
```









